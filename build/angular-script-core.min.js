!function(i,n){"use strict";n.core=i.module("crip.core",[])}(angular,window.crip||(window.crip={})),function(i,n,t,r){"use strict";function e(){function n(i){return this.filter(function(n){return i.indexOf(n)<0})}function e(i,n){for(var t=this.length-1;t>=0;t--)"undefined"==typeof n?this[t]==i&&this.splice(t,1):this[t][n]==i&&this.splice(t,1)}function c(n){return i.isUndefined(n)||""===n||null===n||n!==n}function o(i){return!c(i)}function u(){var n=arguments;if(0===n.length||c(n[0]))return!1;var t=n[0];for(var r in n)if("0"!==r){if(!t.hasOwnProperty(n[r]))return!1;if(t=t[n[r]],i.isUndefined(t))return!1}return!0}function f(i){return this.replace(/{([^{}]*)}/g,function(n,t){var r=i[t];return"string"==typeof r||"number"==typeof r?r:n})}t.prototype.diff=n,t.prototype.removeItem=e,r.prototype.supplant=f,i.extend(i,{isEmpty:c,hasValue:o,hasProperty:u})}n.core.config(e),e.$inject=[]}(angular,window.crip||(window.crip={}),Array,String),function(i,n){"use strict";function t(n){function t(t){return i.isObject(t)&&t instanceof n.File}function r(i){var n="|"+i.type.slice(i.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(n)}i.extend(i,{isFile:t,isImage:r,fileSupport:!(!n.FileReader||!n.CanvasRenderingContext2D)})}n.core.run(t),t.$inject=["$window"]}(angular,window.crip||(window.crip={})),function(i,n){"use strict";function t(){function i(i,n,t,r){n.bind("keydown keypress",function(n){13===n.which&&(i.$apply(function(){i.$eval(t.cripEnter,{event:n})}),n.preventDefault())}),i.$on("$destroy",function(){n.off(t.cFocus)})}return{restrict:"A",link:i}}n.core.directive("cripEnter",t),t.$inject=[]}(angular,window.crip||(window.crip={})),function(i){"use strict";function n(i){function n(n,t,r,e){t.on(r.cripFocus,function(){i(r.cripSelector)}),n.$on("$destroy",function(){t.off(r.cripFocus)})}return{restrict:"A",link:n}}i.core.directive("cripFocus",n),n.$inject=["focus"]}(window.crip||(window.crip={})),function(i,n){"use strict";function t(){function n(n,t,r){function e(i){var n=new Image;n.onload=c,n.src=i.target.result}function c(){var i=o.width||this.width/this.height*o.height,n=o.height||this.height/this.width*o.width;u.attr({width:i,height:n}),u[0].getContext("2d").drawImage(this,0,0,i,n)}if(i.fileSupport){var o=n.$eval(r.cripThumb);if(!i.isFile(o.file)||!i.isImage(o.file))return void t.hide();var u=t.find("canvas"),f=new FileReader;f.onload=e,f.readAsDataURL(o.file)}}return{restrict:"A",template:"<canvas/>",link:n}}n.core.directive("cripThumb",t)}(angular,window.crip||(window.crip={})),function(i,n){"use strict";function t(n){return function(t){n(function(){var n=i(t);1===n.length&&n.focus()})}}n.core.factory("focus",t),t.$inject=["$timeout"]}(jQuery,window.crip||(window.crip={})),function(i,n){"use strict";function t(){var i="-_ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-";this.changeChars=function(n){i=n},this["new"]=function(t){t|=16;for(var r="",e=0;t>e;e++)r+=i.charAt(n.floor(n.random()*i.length));return r}}i.core.service("cripStrRandom",t),t.$inject=[]}(window.crip||(window.crip={}),Math);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9zb3VyY2UvY29yZS5tb2R1bGUuanMiLCIvc291cmNlL2NvbmZpZy5qcyIsIi9zb3VyY2UvZmlsZS5leHRlbnNpb25zLmpzIiwiL3NvdXJjZS9kaXJlY3RpdmVzL2NyaXBFbnRlci5qcyIsIi9zb3VyY2UvZGlyZWN0aXZlcy9jcmlwRm9jdXMuanMiLCIvc291cmNlL2RpcmVjdGl2ZXMvY3JpcFRodW1iLmpzIiwiL3NvdXJjZS9mYWN0b3JpZXMvZm9jdXMuanMiLCIvc291cmNlL3NlcnZpY2VzL2NyaXBTdHJSYW5kb20uanMiXSwibmFtZXMiOlsibmciLCJjcmlwIiwiY29yZSIsIm1vZHVsZSIsImFuZ3VsYXIiLCJ3aW5kb3ciLCJBcnJheSIsIlN0cmluZyIsIkNvcmVDb25maWciLCJkaWZmIiwiYSIsInRoaXMiLCJmaWx0ZXIiLCJpIiwiaW5kZXhPZiIsInJlbW92ZUl0ZW0iLCJ2YWwiLCJrZXkiLCJsZW5ndGgiLCJzcGxpY2UiLCJpc0VtcHR5IiwidmFsdWUiLCJpc1VuZGVmaW5lZCIsImhhc1ZhbHVlIiwiaGFzUHJvcGVydHkiLCJhcmd1bWVudHMiLCJ0YXJnZXQiLCJhcmciLCJoYXNPd25Qcm9wZXJ0eSIsInN1cHBsYW50IiwibyIsInJlcGxhY2UiLCJiIiwiciIsInByb3RvdHlwZSIsImV4dGVuZCIsImNvbmZpZyIsIiRpbmplY3QiLCJGaWxlRXh0ZW5zaW9ucyIsIiR3aW5kb3ciLCJpc0ZpbGUiLCJpdGVtIiwiaXNPYmplY3QiLCJGaWxlIiwiaXNJbWFnZSIsImZpbGUiLCJ0eXBlIiwic2xpY2UiLCJsYXN0SW5kZXhPZiIsImZpbGVTdXBwb3J0IiwiRmlsZVJlYWRlciIsIkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCIsInJ1biIsImNyaXBFbnRlciIsImxpbmsiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsImN0cmwiLCJiaW5kIiwiZXZlbnQiLCJ3aGljaCIsIiRhcHBseSIsIiRldmFsIiwicHJldmVudERlZmF1bHQiLCIkb24iLCJvZmYiLCJjRm9jdXMiLCJyZXN0cmljdCIsImRpcmVjdGl2ZSIsImNyaXBGb2N1cyIsImZvY3VzIiwib24iLCJjcmlwU2VsZWN0b3IiLCJjcmlwVGh1bWIiLCJvbkxvYWRGaWxlIiwiaW1nIiwiSW1hZ2UiLCJvbmxvYWQiLCJvbkxvYWRJbWFnZSIsInNyYyIsInJlc3VsdCIsIndpZHRoIiwicGFyYW1zIiwiaGVpZ2h0IiwiY2FudmFzIiwiYXR0ciIsImdldENvbnRleHQiLCJkcmF3SW1hZ2UiLCJoaWRlIiwiZmluZCIsInJlYWRlciIsInJlYWRBc0RhdGFVUkwiLCJ0ZW1wbGF0ZSIsIiQiLCIkdGltZW91dCIsInNlbGVjdG9yIiwiJGVsZW1lbnQiLCJmYWN0b3J5IiwialF1ZXJ5IiwiTWF0aCIsImNyaXBTdHJSYW5kb20iLCJwb3NzaWJsZSIsImNoYW5nZUNoYXJzIiwiY2hhcnMiLCJjaGFyQXQiLCJmbG9vciIsInJhbmRvbSIsInNlcnZpY2UiXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsWUFFQUEsR0FBQUMsS0FBQUYsRUFBQUcsT0FBQSxpQkFFQUMsUUFBQUMsT0FBQUosT0FBQUksT0FBQUosVUNMQSxTQUFBRCxFQUFBQyxFQUFBSyxFQUFBQyxHQUNBLFlBT0EsU0FBQUMsS0FZQSxRQUFBQyxHQUFBQyxHQUNBLE1BQUFDLE1BQUFDLE9BQUEsU0FBQUMsR0FDQSxNQUFBSCxHQUFBSSxRQUFBRCxHQUFBLElBSUEsUUFBQUUsR0FBQUMsRUFBQUMsR0FDQSxJQUFBLEdBQUFKLEdBQUFGLEtBQUFPLE9BQUEsRUFBQUwsR0FBQSxFQUFBQSxJQUNBLG1CQUFBSSxHQUNBTixLQUFBRSxJQUFBRyxHQUNBTCxLQUFBUSxPQUFBTixFQUFBLEdBRUFGLEtBQUFFLEdBQUFJLElBQUFELEdBQ0FMLEtBQUFRLE9BQUFOLEVBQUEsR0FJQSxRQUFBTyxHQUFBQyxHQUNBLE1BQUFyQixHQUFBc0IsWUFBQUQsSUFBQSxLQUFBQSxHQUFBLE9BQUFBLEdBQUFBLElBQUFBLEVBR0EsUUFBQUUsR0FBQUYsR0FDQSxPQUFB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R0FBQXFCLEVBQUFHLE9BQUFMLEVBQUFNLE1BQUFOLEVBQUFPLFNBQUFMLEVBQUFwRixRQUdBLE9BQUErRCxJQW5CQWhGLEVBQUFDLEtBQ0EwRyxRQUFBLGdCQUFBUCxHQUVBQSxFQUFBaEUsWUFtQkFoQyxPQUFBSixPQUFBSSxPQUFBSixTQUFBbUciLCJmaWxlIjoiYW5ndWxhci1zY3JpcHQtY29yZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKG5nLCBjcmlwKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5jb3JlID0gbmcubW9kdWxlKCdjcmlwLmNvcmUnLCBbXSk7XHJcblxyXG59KShhbmd1bGFyLCB3aW5kb3cuY3JpcCB8fCAod2luZG93LmNyaXAgPSB7fSkpOyIsIihmdW5jdGlvbiAobmcsIGNyaXAsIEFycmF5LCBTdHJpbmcpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmNvcmVcclxuICAgICAgICAuY29uZmlnKENvcmVDb25maWcpO1xyXG5cclxuICAgIENvcmVDb25maWcuJGluamVjdCA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIENvcmVDb25maWcoKSB7XHJcbiAgICAgICAgQXJyYXkucHJvdG90eXBlLmRpZmYgPSBkaWZmO1xyXG4gICAgICAgIEFycmF5LnByb3RvdHlwZS5yZW1vdmVJdGVtID0gcmVtb3ZlSXRlbTtcclxuXHJcbiAgICAgICAgU3RyaW5nLnByb3RvdHlwZS5zdXBwbGFudCA9IHN1cHBsYW50O1xyXG5cclxuICAgICAgICBuZy5leHRlbmQobmcsIHtcclxuICAgICAgICAgICAgaXNFbXB0eTogaXNFbXB0eSxcclxuICAgICAgICAgICAgaGFzVmFsdWU6IGhhc1ZhbHVlLFxyXG4gICAgICAgICAgICBoYXNQcm9wZXJ0eTogaGFzUHJvcGVydHlcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZGlmZihhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbiAoaSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGEuaW5kZXhPZihpKSA8IDA7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlSXRlbSh2YWwsIGtleSkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBrZXkgPT09IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpc1tpXSA9PSB2YWwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpc1tpXVtrZXldID09IHZhbClcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNFbXB0eSh2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmcuaXNVbmRlZmluZWQodmFsdWUpIHx8IHZhbHVlID09PSAnJyB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSAhPT0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoYXNWYWx1ZSh2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gIWlzRW1wdHkodmFsdWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGFzUHJvcGVydHkoKSB7XHJcbiAgICAgICAgICAgIHZhciBhID0gYXJndW1lbnRzO1xyXG5cclxuICAgICAgICAgICAgaWYgKGEubGVuZ3RoID09PSAwIHx8IGlzRW1wdHkoYVswXSkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gYVswXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgYXJnIGluIGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhcmcgPT09ICcwJylcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRhcmdldC5oYXNPd25Qcm9wZXJ0eShhW2FyZ10pKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXRbYVthcmddXTtcclxuICAgICAgICAgICAgICAgIGlmIChuZy5pc1VuZGVmaW5lZCh0YXJnZXQpKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBBIHNpbXBsZSB0ZW1wbGF0aW5nIG1ldGhvZCBmb3IgcmVwbGFjaW5nIHBsYWNlaG9sZGVycyBlbmNsb3NlZCBpbiBjdXJseSBicmFjZXMuXHJcbiAgICAgICAgZnVuY3Rpb24gc3VwcGxhbnQobykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC97KFtee31dKil9L2csXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByID0gb1tiXTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHIgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiByID09PSAnbnVtYmVyJyA/IHIgOiBhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoYW5ndWxhciwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pLCBBcnJheSwgU3RyaW5nKTsiLCIoZnVuY3Rpb24obmcsIGNyaXApe1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuY29yZVxyXG4gICAgICAgIC5ydW4oRmlsZUV4dGVuc2lvbnMpO1xyXG5cclxuICAgIEZpbGVFeHRlbnNpb25zLiRpbmplY3QgPSBbJyR3aW5kb3cnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBGaWxlRXh0ZW5zaW9ucygkd2luZG93KSB7XHJcblxyXG4gICAgICAgIG5nLmV4dGVuZChuZywge1xyXG4gICAgICAgICAgICBpc0ZpbGU6IGlzRmlsZSxcclxuICAgICAgICAgICAgaXNJbWFnZTogaXNJbWFnZSxcclxuICAgICAgICAgICAgZmlsZVN1cHBvcnQ6ICEhKCR3aW5kb3cuRmlsZVJlYWRlciAmJiAkd2luZG93LkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRClcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNGaWxlKGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5nLmlzT2JqZWN0KGl0ZW0pICYmIGl0ZW0gaW5zdGFuY2VvZiAkd2luZG93LkZpbGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0ltYWdlKGZpbGUpIHtcclxuICAgICAgICAgICAgdmFyIHR5cGUgPSAnfCcgKyBmaWxlLnR5cGUuc2xpY2UoZmlsZS50eXBlLmxhc3RJbmRleE9mKCcvJykgKyAxKSArICd8JztcclxuICAgICAgICAgICAgcmV0dXJuICd8anBnfHBuZ3xqcGVnfGJtcHxnaWZ8Jy5pbmRleE9mKHR5cGUpICE9PSAtMTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKGFuZ3VsYXIsIHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSk7IiwiKGZ1bmN0aW9uIChuZywgY3JpcCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuY29yZVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ2NyaXBFbnRlcicsIGNyaXBFbnRlcik7XHJcblxyXG4gICAgY3JpcEVudGVyLiRpbmplY3QgPSBbXTtcclxuXHJcbiAgICBmdW5jdGlvbiBjcmlwRW50ZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgbGluazogbGlua1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuYmluZChcImtleWRvd24ga2V5cHJlc3NcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWwoYXR0cnMuY3JpcEVudGVyLCB7J2V2ZW50JzogZXZlbnR9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBSZW1vdmVzIGJvdW5kIGV2ZW50cyBpbiB0aGUgZWxlbWVudCBpdHNlbGZcclxuICAgICAgICAgICAgLy8gd2hlbiB0aGUgc2NvcGUgaXMgZGVzdHJveWVkXHJcbiAgICAgICAgICAgIHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9mZihhdHRycy5jRm9jdXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKGFuZ3VsYXIsIHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSk7XHJcbiIsIihmdW5jdGlvbiAoY3JpcCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuY29yZVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ2NyaXBGb2N1cycsIGNyaXBGb2N1cyk7XHJcblxyXG4gICAgY3JpcEZvY3VzLiRpbmplY3QgPSBbJ2ZvY3VzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gY3JpcEZvY3VzKGZvY3VzKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgbGluazogbGlua1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQub24oYXR0cnMuY3JpcEZvY3VzLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBmb2N1cyhhdHRycy5jcmlwU2VsZWN0b3IpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJlbW92ZXMgYm91bmQgZXZlbnRzIGluIHRoZSBlbGVtZW50IGl0c2VsZlxyXG4gICAgICAgICAgICAvLyB3aGVuIHRoZSBzY29wZSBpcyBkZXN0cm95ZWRcclxuICAgICAgICAgICAgc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQub2ZmKGF0dHJzLmNyaXBGb2N1cyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkod2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pKTsiLCIoZnVuY3Rpb24gKG5nLCBjcmlwKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5jb3JlXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnY3JpcFRodW1iJywgY3JpcFRodW1iKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjcmlwVGh1bWIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8Y2FudmFzLz4nLFxyXG4gICAgICAgICAgICBsaW5rOiBsaW5rXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpe1xyXG4gICAgICAgICAgICBpZighbmcuZmlsZVN1cHBvcnQpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBzY29wZS4kZXZhbChhdHRycy5jcmlwVGh1bWIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFuZy5pc0ZpbGUocGFyYW1zLmZpbGUpIHx8ICFuZy5pc0ltYWdlKHBhcmFtcy5maWxlKSkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBjYW52YXMgPSBlbGVtZW50LmZpbmQoJ2NhbnZhcycpO1xyXG4gICAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuXHJcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBvbkxvYWRGaWxlO1xyXG4gICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChwYXJhbXMuZmlsZSk7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBvbkxvYWRGaWxlKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XHJcbiAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gb25Mb2FkSW1hZ2U7XHJcbiAgICAgICAgICAgICAgICBpbWcuc3JjID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gb25Mb2FkSW1hZ2UoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSBwYXJhbXMud2lkdGggfHwgdGhpcy53aWR0aCAvIHRoaXMuaGVpZ2h0ICogcGFyYW1zLmhlaWdodDtcclxuICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBwYXJhbXMuaGVpZ2h0IHx8IHRoaXMuaGVpZ2h0IC8gdGhpcy53aWR0aCAqIHBhcmFtcy53aWR0aDtcclxuICAgICAgICAgICAgICAgIGNhbnZhcy5hdHRyKHt3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0fSk7XHJcbiAgICAgICAgICAgICAgICBjYW52YXNbMF0uZ2V0Q29udGV4dCgnMmQnKS5kcmF3SW1hZ2UodGhpcywgMCwgMCwgd2lkdGgsIGhlaWdodCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KShhbmd1bGFyLCB3aW5kb3cuY3JpcCB8fCAod2luZG93LmNyaXAgPSB7fSkpOyIsIihmdW5jdGlvbiAoJCwgY3JpcCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuY29yZVxyXG4gICAgICAgIC5mYWN0b3J5KCdmb2N1cycsIGZvY3VzKTtcclxuXHJcbiAgICBmb2N1cy4kaW5qZWN0ID0gWyckdGltZW91dCddO1xyXG5cclxuICAgIGZ1bmN0aW9uIGZvY3VzKCR0aW1lb3V0KSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzZWxlY3Rvcikge1xyXG4gICAgICAgICAgICAvLyB0aW1lb3V0IG1ha2VzIHN1cmUgdGhhdCBpdCBpcyBpbnZva2VkIGFmdGVyIGFueSBvdGhlciBldmVudCBoYXMgYmVlbiB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgIC8vIGUuZy4gY2xpY2sgZXZlbnRzIHRoYXQgbmVlZCB0byBydW4gYmVmb3JlIHRoZSBmb2N1cyBvclxyXG4gICAgICAgICAgICAvLyBpbnB1dHMgZWxlbWVudHMgdGhhdCBhcmUgaW4gYSBkaXNhYmxlZCBzdGF0ZSBidXQgYXJlIGVuYWJsZWQgd2hlbiB0aG9zZSBldmVudHNcclxuICAgICAgICAgICAgLy8gYXJlIHRyaWdnZXJlZC5cclxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgJGVsZW1lbnQgPSAkKHNlbGVjdG9yKTtcclxuICAgICAgICAgICAgICAgIGlmKCRlbGVtZW50Lmxlbmd0aCA9PT0gMSlcclxuICAgICAgICAgICAgICAgICAgICAkZWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKGpRdWVyeSwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pKTsiLCIoZnVuY3Rpb24gKGNyaXAsIE1hdGgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmNvcmVcclxuICAgICAgICAuc2VydmljZSgnY3JpcFN0clJhbmRvbScsIGNyaXBTdHJSYW5kb20pO1xyXG5cclxuICAgIGNyaXBTdHJSYW5kb20uJGluamVjdCA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNyaXBTdHJSYW5kb20oKSB7XHJcbiAgICAgICAgdmFyIHBvc3NpYmxlID0gJy1fQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODlfLSc7XHJcblxyXG4gICAgICAgIHRoaXMuY2hhbmdlQ2hhcnMgPSBmdW5jdGlvbiAoY2hhcnMpIHtcclxuICAgICAgICAgICAgcG9zc2libGUgPSBjaGFycztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLm5ldyA9IGZ1bmN0aW9uIChsZW5ndGgpIHtcclxuICAgICAgICAgICAgbGVuZ3RoIHw9IDE2O1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gJyc7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwb3NzaWJsZS5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcG9zc2libGUubGVuZ3RoKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkod2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pLCBNYXRoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
