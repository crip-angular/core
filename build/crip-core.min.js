!function(t,n){"use strict";n.core=t.module("crip.core",[])}(angular,window.crip||(window.crip={})),function(t){"use strict";function n(t){return this.filter(function(n){return t.indexOf(n)<0})}function i(t,n){if("undefined"==typeof n)return void this.splice(this.indexOf(t)||this.length,1);for(var i=this.length-1;i>=0;i--)this[i][n]==t&&this.splice(i,1)}function e(t){var n=arguments;"undefined"==typeof t&&(n=[void 0,"",null,NaN]);for(var i=0;i<this.length;i++)for(var e=0;e<n.length;e++)this[i]===n[e]&&(this.splice(i,1),i--);return this}t.prototype.diff=n,t.prototype.removeItem=i,t.prototype.clean=e}(Array),function(t,n,i,e,r,o,c){"use strict";function u(){function n(n){return t.isUndefined(n)||""===n||null===n||n!==n}function i(t){return!n(t)}function e(i,e){var r=arguments;if(0===r.length||n(r[0]))return!1;var o=r[0];for(var c in r)if("0"!==c){if(!o.hasOwnProperty(r[c]))return!1;if(o=o[r[c]],t.isUndefined(o))return!1}return!0}t.extend(t,{isEmpty:n,hasValue:i,hasProperty:e})}n.core.config(u),u.$inject=[]}(angular,window.crip||(window.crip={}),Array,String,Number,Math,RegExp),function(t,n){"use strict";function i(n){function i(i){return t.isObject(i)&&i instanceof n.File}function e(t){var n="|"+t.type.slice(t.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(n)}t.extend(t,{isFile:i,isImage:e,isHtml5:!(!File||!FormData),fileSupport:!(!n.FileReader||!n.CanvasRenderingContext2D)})}n.core.run(i),i.$inject=["$window"]}(angular,window.crip||(window.crip={})),function(t){"use strict";function n(t){return t=t||(t={}),t.value=this,t.size=Math.log(t.value)/Math.log(1e3)|0,t.num=(t.value/Math.pow(1e3,t.size)).toFixed(2),t.text=t.size?"kMGTPEZY"[--t.size]+"B":"Bytes","{num} {text}".supplant(t)}t.prototype.toBytes=n}(Number),function(t){"use strict";function n(t){return this.replace(/{([^{}]*)}/g,function(n,i){var e=t[i];return"string"==typeof e||"number"==typeof e?e:n})}function i(t,n){var i=this;return i.replace(new RegExp(t,"g"),n)}t.prototype.supplant=n,t.prototype.replaceAll=i}(String),function(t,n){"use strict";function i(t){function n(n,i,e,r){var o=t(e.cripContextmenu);i.bind("contextmenu",function(t){n.$apply(function(){t.preventDefault(),o(n,{$event:t,$element:i})})}),n.$on("$destroy",function(){i.off(e.cripContextmenu)})}return{restrict:"A",link:n}}n.core.directive("cripContextmenu",i),i.$inject=["$parse"]}(angular,window.crip||(window.crip={})),function(t,n){"use strict";function i(){function t(t,n,i,e){n.bind("keydown keypress",function(n){13===n.which&&(t.$apply(function(){t.$eval(i.cripEnter,{event:n})}),n.preventDefault())}),t.$on("$destroy",function(){n.off(i.cripEnter)})}return{restrict:"A",link:t}}n.core.directive("cripEnter",i),i.$inject=[]}(angular,window.crip||(window.crip={})),function(t){"use strict";function n(t){function n(n,i,e,r){i.on(e.cripFocus,function(){t(e.cripSelector)}),n.$on("$destroy",function(){i.off(e.cripFocus)})}return{restrict:"A",link:n}}t.core.directive("cripFocus",n),n.$inject=["focus"]}(window.crip||(window.crip={})),function(t,n){"use strict";function i(){function n(n,i,e){function r(t){var n=new Image;n.onload=o,n.src=t.target.result}function o(){var t=c.width||this.width/this.height*c.height,n=c.height||this.height/this.width*c.width;u.attr({width:t,height:n}),u[0].getContext("2d").drawImage(this,0,0,t,n)}if(t.fileSupport){var c=n.$eval(e.cripThumb);if(!t.isFile(c.file)||!t.isImage(c.file))return void i.hide();var u=i.find("canvas"),f=new FileReader;f.onload=r,f.readAsDataURL(c.file)}}return{restrict:"A",template:"<canvas/>",link:n}}n.core.directive("cripThumb",i)}(angular,window.crip||(window.crip={})),function(t,n){"use strict";function i(n){return function(i,e){n(function(){var n=t(i);1===n.length&&("function"==typeof e?n.focus(e):n.focus())})}}n.core.factory("focus",i),i.$inject=["$timeout"]}(jQuery,window.crip||(window.crip={})),function(t,n){"use strict";function i(){var t="-_ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-";this.changeChars=function(n){t=n},this["new"]=function(i){i|=16;for(var e="",r=0;i>r;r++)e+=t.charAt(n.floor(n.random()*t.length));return e}}t.core.service("cripStrRandom",i),i.$inject=[]}(window.crip||(window.crip={}),Math);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9zb3VyY2UvY29yZS5tb2R1bGUuanMiLCIvc291cmNlL2FycmF5LmV4dGVuc2lvbnMuanMiLCIvc291cmNlL2NvbmZpZy5qcyIsIi9zb3VyY2UvZmlsZS5leHRlbnNpb25zLmpzIiwiL3NvdXJjZS9udW1iZXIuZXh0ZW5zaW9ucy5qcyIsIi9zb3VyY2Uvc3RyaW5nLmV4dGVuc2lvbnMuanMiLCIvc291cmNlL2RpcmVjdGl2ZXMvY3JpcENvbnRleHRtZW51LmpzIiwiL3NvdXJjZS9kaXJlY3RpdmVzL2NyaXBFbnRlci5qcyIsIi9zb3VyY2UvZGlyZWN0aXZlcy9jcmlwRm9jdXMuanMiLCIvc291cmNlL2RpcmVjdGl2ZXMvY3JpcFRodW1iLmpzIiwiL3NvdXJjZS9mYWN0b3JpZXMvZm9jdXMuanMiLCIvc291cmNlL3NlcnZpY2VzL2NyaXBTdHJSYW5kb20uanMiXSwibmFtZXMiOlsibmciLCJjcmlwIiwiY29yZSIsIm1vZHVsZSIsImFuZ3VsYXIiLCJ3aW5kb3ciLCJBcnJheSIsImRpZmYiLCJhIiwidGhpcyIsImZpbHRlciIsImkiLCJpbmRleE9mIiwicmVtb3ZlSXRlbSIsInZhbCIsImtleSIsInNwbGljZSIsImxlbmd0aCIsImNsZWFuIiwiZGVsZXRlX3ZhbHVlIiwiY2xlYW5fZnJvbSIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsIk5hTiIsImoiLCJwcm90b3R5cGUiLCJTdHJpbmciLCJOdW1iZXIiLCJNYXRoIiwiUmVnRXhwIiwiQ29yZUNvbmZpZyIsImlzRW1wdHkiLCJ2YWx1ZSIsImlzVW5kZWZpbmVkIiwiaGFzVmFsdWUiLCJoYXNQcm9wZXJ0eSIsIm9iamVjdCIsInByb3BlcnRpZXMiLCJ0YXJnZXQiLCJhcmciLCJoYXNPd25Qcm9wZXJ0eSIsImV4dGVuZCIsImNvbmZpZyIsIiRpbmplY3QiLCJGaWxlRXh0ZW5zaW9ucyIsIiR3aW5kb3ciLCJpc0ZpbGUiLCJpdGVtIiwiaXNPYmplY3QiLCJGaWxlIiwiaXNJbWFnZSIsImZpbGUiLCJ0eXBlIiwic2xpY2UiLCJsYXN0SW5kZXhPZiIsImlzSHRtbDUiLCJGb3JtRGF0YSIsImZpbGVTdXBwb3J0IiwiRmlsZVJlYWRlciIsIkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCIsInJ1biIsInRvQnl0ZXMiLCJob2xkZXIiLCJzaXplIiwibG9nIiwibnVtIiwicG93IiwidG9GaXhlZCIsInRleHQiLCJzdXBwbGFudCIsIm8iLCJyZXBsYWNlIiwiYiIsInIiLCJyZXBsYWNlQWxsIiwic2VhcmNoVmFsdWUiLCJyZXBsYWNlVmFsdWUiLCJjcmlwQ29udGV4dG1lbnUiLCIkcGFyc2UiLCJsaW5rIiwic2NvcGUiLCJlbGVtZW50IiwiYXR0cnMiLCJjdHJsIiwiZm4iLCJiaW5kIiwiZXZlbnQiLCIkYXBwbHkiLCJwcmV2ZW50RGVmYXVsdCIsIiRldmVudCIsIiRlbGVtZW50IiwiJG9uIiwib2ZmIiwicmVzdHJpY3QiLCJkaXJlY3RpdmUiLCJjcmlwRW50ZXIiLCJ3aGljaCIsIiRldmFsIiwiY3JpcEZvY3VzIiwiZm9jdXMiLCJvbiIsImNyaXBTZWxlY3RvciIsImNyaXBUaHVtYiIsIm9uTG9hZEZpbGUiLCJpbWciLCJJbWFnZSIsIm9ubG9hZCIsIm9uTG9hZEltYWdlIiwic3JjIiwicmVzdWx0Iiwid2lkdGgiLCJwYXJhbXMiLCJoZWlnaHQiLCJjYW52YXMiLCJhdHRyIiwiZ2V0Q29udGV4dCIsImRyYXdJbWFnZSIsImhpZGUiLCJmaW5kIiwicmVhZGVyIiwicmVhZEFzRGF0YVVSTCIsInRlbXBsYXRlIiwiJCIsIiR0aW1lb3V0Iiwic2VsZWN0b3IiLCJjYWxsYmFjayIsImZhY3RvcnkiLCJqUXVlcnkiLCJjcmlwU3RyUmFuZG9tIiwicG9zc2libGUiLCJjaGFuZ2VDaGFycyIsImNoYXJzIiwiY2hhckF0IiwiZmxvb3IiLCJyYW5kb20iLCJzZXJ2aWNlIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxHQUNBLFlBRUFBLEdBQUFDLEtBQUFGLEVBQUFHLE9BQUEsaUJBRUFDLFFBQUFDLE9BQUFKLE9BQUFJLE9BQUFKLFVDTEEsU0FBQUssR0FDQSxZQVlBLFNBQUFDLEdBQUFDLEdBQ0EsTUFBQUMsTUFBQUMsT0FBQSxTQUFBQyxHQUNBLE1BQUFILEdBQUFJLFFBQUFELEdBQUEsSUFVQSxRQUFBRSxHQUFBQyxFQUFBQyxHQUNBLEdBQUEsbUJBQUFBLEdBRUEsV0FEQU4sTUFBQU8sT0FBQVAsS0FBQUcsUUFBQUUsSUFBQUwsS0FBQVEsT0FBQSxFQUlBLEtBQUEsR0FBQU4sR0FBQUYsS0FBQVEsT0FBQSxFQUFBTixHQUFBLEVBQUFBLElBQ0FGLEtBQUFFLEdBQUFJLElBQUFELEdBQ0FMLEtBQUFPLE9BQUFMLEVBQUEsR0FXQSxRQUFBTyxHQUFBQyxHQUNBLEdBQUFDLEdBQUFDLFNBQ0Esb0JBQUFGLEtBQ0FDLEdBQUFFLE9BQUEsR0FBQSxLQUFBQyxLQUdBLEtBQUEsR0FBQVosR0FBQSxFQUFBQSxFQUFBRixLQUFBUSxPQUFBTixJQUNBLElBQUEsR0FBQWEsR0FBQSxFQUFBQSxFQUFBSixFQUFBSCxPQUFBTyxJQUNBZixLQUFBRSxLQUFBUyxFQUFBSSxLQUNBZixLQUFBTyxPQUFBTCxFQUFBLEdBQ0FBLElBS0EsT0FBQUYsTUF4REFILEVBQUFtQixVQUFBbEIsS0FBQUEsRUFDQUQsRUFBQW1CLFVBQUFaLFdBQUFBLEVBQ0FQLEVBQUFtQixVQUFBUCxNQUFBQSxHQXlEQVosT0M5REEsU0FBQU4sRUFBQUMsRUFBQUssRUFBQW9CLEVBQUFDLEVBQUFDLEVBQUFDLEdBQ0EsWUFPQSxTQUFBQyxLQWNBLFFBQUFDLEdBQUFDLEdBQ0EsTUFBQWhDLEdBQUFpQyxZQUFBRCxJQUFBLEtBQUFBLEdBQUEsT0FBQUEsR0FBQUEsSUFBQUEsRUFTQSxRQUFBRSxHQUFBRixHQUNBLE9BQUFELEVBQUFDLEdBVUEsUUFBQUcsR0FBQUMsRUFBQUMsR0FDQSxHQUFBN0IsR0FBQWEsU0FFQSxJQUFBLElBQUFiLEVBQUFTLFFBQUFjLEVBQUF2QixFQUFBLElBQ0EsT0FBQSxDQUVBLElBQUE4QixHQUFBOUIsRUFBQSxFQUNBLEtBQUEsR0FBQStCLEtBQUEvQixHQUNBLEdBQUEsTUFBQStCLEVBQUEsQ0FHQSxJQUFBRCxFQUFBRSxlQUFBaEMsRUFBQStCLElBQ0EsT0FBQSxDQUdBLElBREFELEVBQUFBLEVBQUE5QixFQUFBK0IsSUFDQXZDLEVBQUFpQyxZQUFBSyxHQUNBLE9BQUEsRUFHQSxPQUFBLEVBcERBdEMsRUFBQXlDLE9BQUF6QyxHQUNBK0IsUUFBQUEsRUFDQUcsU0FBQUEsRUFDQUMsWUFBQUEsSUFWQWxDLEVBQUFDLEtBQ0F3QyxPQUFBWixHQUVBQSxFQUFBYSxZQTJEQXZDLFFBQUFDLE9BQUFKLE9BQUFJLE9BQUFKLFNBQUFLLE1BQUFvQixPQUFBQyxPQUFBQyxLQUFBQyxRQ2pFQSxTQUFBN0IsRUFBQUMsR0FDQSxZQU9BLFNBQUEyQyxHQUFBQyxHQWVBLFFBQUFDLEdBQUFDLEdBQ0EsTUFBQS9DLEdBQUFnRCxTQUFBRCxJQUFBQSxZQUFBRixHQUFBSSxLQVNBLFFBQUFDLEdBQUFDLEdBQ0EsR0FBQUMsR0FBQSxJQUFBRCxFQUFBQyxLQUFBQyxNQUFBRixFQUFBQyxLQUFBRSxZQUFBLEtBQUEsR0FBQSxHQUNBLE9BQUEsS0FBQSx5QkFBQTFDLFFBQUF3QyxHQXpCQXBELEVBQUF5QyxPQUFBekMsR0FDQThDLE9BQUFBLEVBQ0FJLFFBQUFBLEVBQ0FLLFdBQUFOLE9BQUFPLFVBQ0FDLGVBQUFaLEVBQUFhLGFBQUFiLEVBQUFjLDRCQVhBMUQsRUFBQUMsS0FDQTBELElBQUFoQixHQUVBQSxFQUFBRCxTQUFBLFlBZ0NBdkMsUUFBQUMsT0FBQUosT0FBQUksT0FBQUosVUN0Q0EsU0FBQTBCLEdBQ0EsWUFVQSxTQUFBa0MsR0FBQUMsR0FPQSxNQU5BQSxHQUFBQSxJQUFBQSxNQUNBQSxFQUFBOUIsTUFBQXZCLEtBQ0FxRCxFQUFBQyxLQUFBbkMsS0FBQW9DLElBQUFGLEVBQUE5QixPQUFBSixLQUFBb0MsSUFBQSxLQUFBLEVBQ0FGLEVBQUFHLEtBQUFILEVBQUE5QixNQUFBSixLQUFBc0MsSUFBQSxJQUFBSixFQUFBQyxPQUFBSSxRQUFBLEdBQ0FMLEVBQUFNLEtBQUFOLEVBQUFDLEtBQUEsYUFBQUQsRUFBQUMsTUFBQSxJQUFBLFFBRUEsZUFBQU0sU0FBQVAsR0FmQW5DLEVBQUFGLFVBQUFvQyxRQUFBQSxHQWlCQWxDLFFDcEJBLFNBQUFELEdBQ0EsWUFXQSxTQUFBMkMsR0FBQUMsR0FDQSxNQUFBN0QsTUFBQThELFFBQUEsY0FDQSxTQUFBL0QsRUFBQWdFLEdBQ0EsR0FBQUMsR0FBQUgsRUFBQUUsRUFDQSxPQUFBLGdCQUFBQyxJQUFBLGdCQUFBQSxHQUFBQSxFQUFBakUsSUFZQSxRQUFBa0UsR0FBQUMsRUFBQUMsR0FDQSxHQUFBdEMsR0FBQTdCLElBQ0EsT0FBQTZCLEdBQUFpQyxRQUFBLEdBQUExQyxRQUFBOEMsRUFBQSxLQUFBQyxHQTNCQWxELEVBQUFELFVBQUE0QyxTQUFBQSxFQUNBM0MsRUFBQUQsVUFBQWlELFdBQUFBLEdBNkJBaEQsUUNqQ0EsU0FBQTFCLEVBQUFDLEdBQ0EsWUFPQSxTQUFBNEUsR0FBQUMsR0FNQSxRQUFBQyxHQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBLEdBQUFDLEdBQUFOLEVBQUFJLEVBQUFMLGdCQUNBSSxHQUFBSSxLQUFBLGNBQUEsU0FBQUMsR0FDQU4sRUFBQU8sT0FBQSxXQUNBRCxFQUFBRSxpQkFDQUosRUFBQUosR0FBQVMsT0FBQUgsRUFBQUksU0FBQVQsUUFNQUQsRUFBQVcsSUFBQSxXQUFBLFdBQ0FWLEVBQUFXLElBQUFWLEVBQUFMLG1CQWpCQSxPQUNBZ0IsU0FBQSxJQUNBZCxLQUFBQSxHQVJBOUUsRUFBQUMsS0FDQTRGLFVBQUEsa0JBQUFqQixHQUVBQSxFQUFBbEMsU0FBQSxXQXdCQXZDLFFBQUFDLE9BQUFKLE9BQUFJLE9BQUFKLFVDOUJBLFNBQUFELEVBQUFDLEdBQ0EsWUFPQSxTQUFBOEYsS0FNQSxRQUFBaEIsR0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQUYsRUFBQUksS0FBQSxtQkFBQSxTQUFBQyxHQUNBLEtBQUFBLEVBQUFVLFFBQ0FoQixFQUFBTyxPQUFBLFdBQ0FQLEVBQUFpQixNQUFBZixFQUFBYSxXQUFBVCxNQUFBQSxNQUdBQSxFQUFBRSxvQkFNQVIsRUFBQVcsSUFBQSxXQUFBLFdBQ0FWLEVBQUFXLElBQUFWLEVBQUFhLGFBbkJBLE9BQ0FGLFNBQUEsSUFDQWQsS0FBQUEsR0FSQTlFLEVBQUFDLEtBQ0E0RixVQUFBLFlBQUFDLEdBRUFBLEVBQUFwRCxZQTBCQXZDLFFBQUFDLE9BQUFKLE9BQUFJLE9BQUFKLFVDaENBLFNBQUFBLEdBQ0EsWUFPQSxTQUFBaUcsR0FBQUMsR0FNQSxRQUFBcEIsR0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQUYsRUFBQW1CLEdBQUFsQixFQUFBZ0IsVUFBQSxXQUNBQyxFQUFBakIsRUFBQW1CLGdCQUtBckIsRUFBQVcsSUFBQSxXQUFBLFdBQ0FWLEVBQUFXLElBQUFWLEVBQUFnQixhQWJBLE9BQ0FMLFNBQUEsSUFDQWQsS0FBQUEsR0FSQTlFLEVBQUFDLEtBQ0E0RixVQUFBLFlBQUFJLEdBRUFBLEVBQUF2RCxTQUFBLFVBb0JBdEMsT0FBQUosT0FBQUksT0FBQUosVUMxQkEsU0FBQUQsRUFBQUMsR0FDQSxZQUtBLFNBQUFxRyxLQU9BLFFBQUF2QixHQUFBQyxFQUFBQyxFQUFBQyxHQWdCQSxRQUFBcUIsR0FBQWpCLEdBQ0EsR0FBQWtCLEdBQUEsR0FBQUMsTUFDQUQsR0FBQUUsT0FBQUMsRUFDQUgsRUFBQUksSUFBQXRCLEVBQUFoRCxPQUFBdUUsT0FHQSxRQUFBRixLQUNBLEdBQUFHLEdBQUFDLEVBQUFELE9BQUFyRyxLQUFBcUcsTUFBQXJHLEtBQUF1RyxPQUFBRCxFQUFBQyxPQUNBQSxFQUFBRCxFQUFBQyxRQUFBdkcsS0FBQXVHLE9BQUF2RyxLQUFBcUcsTUFBQUMsRUFBQUQsS0FDQUcsR0FBQUMsTUFBQUosTUFBQUEsRUFBQUUsT0FBQUEsSUFDQUMsRUFBQSxHQUFBRSxXQUFBLE1BQUFDLFVBQUEzRyxLQUFBLEVBQUEsRUFBQXFHLEVBQUFFLEdBekJBLEdBQUFoSCxFQUFBeUQsWUFBQSxDQUVBLEdBQUFzRCxHQUFBL0IsRUFBQWlCLE1BQUFmLEVBQUFvQixVQUVBLEtBQUF0RyxFQUFBOEMsT0FBQWlFLEVBQUE1RCxRQUFBbkQsRUFBQWtELFFBQUE2RCxFQUFBNUQsTUFFQSxXQURBOEIsR0FBQW9DLE1BSUEsSUFBQUosR0FBQWhDLEVBQUFxQyxLQUFBLFVBQ0FDLEVBQUEsR0FBQTdELFdBRUE2RCxHQUFBYixPQUFBSCxFQUNBZ0IsRUFBQUMsY0FBQVQsRUFBQTVELE9BcEJBLE9BQ0EwQyxTQUFBLElBQ0E0QixTQUFBLFlBQ0ExQyxLQUFBQSxHQVBBOUUsRUFBQUMsS0FDQTRGLFVBQUEsWUFBQVEsSUF3Q0FsRyxRQUFBQyxPQUFBSixPQUFBSSxPQUFBSixVQzVDQSxTQUFBeUgsRUFBQXpILEdBQ0EsWUFPQSxTQUFBa0csR0FBQXdCLEdBQ0EsTUFBQSxVQUFBQyxFQUFBQyxHQUtBRixFQUFBLFdBQ0EsR0FBQWpDLEdBQUFnQyxFQUFBRSxFQUNBLEtBQUFsQyxFQUFBekUsU0FDQSxrQkFBQTRHLEdBQ0FuQyxFQUFBUyxNQUFBMEIsR0FFQW5DLEVBQUFTLFlBakJBbEcsRUFBQUMsS0FDQTRILFFBQUEsUUFBQTNCLEdBRUFBLEVBQUF4RCxTQUFBLGFBbUJBb0YsT0FBQTFILE9BQUFKLE9BQUFJLE9BQUFKLFVDekJBLFNBQUFBLEVBQUEyQixHQUNBLFlBT0EsU0FBQW9HLEtBQ0EsR0FBQUMsR0FBQSxvRUFFQXhILE1BQUF5SCxZQUFBLFNBQUFDLEdBQ0FGLEVBQUFFLEdBR0ExSCxLQUFBQSxPQUFBLFNBQUFRLEdBQ0FBLEdBQUEsRUFFQSxLQUFBLEdBREE0RixHQUFBLEdBQ0FsRyxFQUFBLEVBQUFNLEVBQUFOLEVBQUFBLElBQ0FrRyxHQUFBb0IsRUFBQUcsT0FBQXhHLEVBQUF5RyxNQUFBekcsRUFBQTBHLFNBQUFMLEVBQUFoSCxRQUdBLE9BQUE0RixJQW5CQTVHLEVBQUFDLEtBQ0FxSSxRQUFBLGdCQUFBUCxHQUVBQSxFQUFBckYsWUFtQkF0QyxPQUFBSixPQUFBSSxPQUFBSixTQUFBMkIiLCJmaWxlIjoiY3JpcC1jb3JlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAobmcsIGNyaXApIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmNvcmUgPSBuZy5tb2R1bGUoJ2NyaXAuY29yZScsIFtdKTtcclxuXHJcbn0pKGFuZ3VsYXIsIHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSk7IiwiKGZ1bmN0aW9uIChBcnJheSkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIEFycmF5LnByb3RvdHlwZS5kaWZmID0gZGlmZjtcclxuICAgIEFycmF5LnByb3RvdHlwZS5yZW1vdmVJdGVtID0gcmVtb3ZlSXRlbTtcclxuICAgIEFycmF5LnByb3RvdHlwZS5jbGVhbiA9IGNsZWFuO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IGRpZmZlcmVudCBlbGVtZW50cyBmcm9tIEFycmF5XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHtBcnJheX0gYVxyXG4gICAgICogQHJldHVybnMge0FycmF5fVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBkaWZmKGEpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24gKGkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGEuaW5kZXhPZihpKSA8IDA7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZW1vdmUgaXRlbSBmcm9tIEFycmF5XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHsqfSB2YWxcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXlcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gcmVtb3ZlSXRlbSh2YWwsIGtleSkge1xyXG4gICAgICAgIGlmICh0eXBlb2Yga2V5ID09PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3BsaWNlKCh0aGlzLmluZGV4T2YodmFsKSB8fCB0aGlzLmxlbmd0aCksIDEpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgICAgICBpZiAodGhpc1tpXVtrZXldID09IHZhbClcclxuICAgICAgICAgICAgICAgIHRoaXMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENsZWFuIGFycmF5IGZyb20gZW1wdHkgdmFsdWVzXHJcbiAgICAgKiBJZiBwYXJhbWV0ZXJzIHByZXNlbnRlZCwgZGVsZXRlIGl0ZW1zIHdpdGNoIGNvbnRhaW5zIHBhc3NlZCB2YWx1ZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7Li4uVH0gW2RlbGV0ZV92YWx1ZV1cclxuICAgICAqIEByZXR1cm5zIHtBcnJheX1cclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gY2xlYW4oZGVsZXRlX3ZhbHVlKSB7XHJcbiAgICAgICAgdmFyIGNsZWFuX2Zyb20gPSBhcmd1bWVudHM7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBkZWxldGVfdmFsdWUgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIGNsZWFuX2Zyb20gPSBbdW5kZWZpbmVkLCAnJywgbnVsbCwgTmFOXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNsZWFuX2Zyb20ubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzW2ldID09PSBjbGVhbl9mcm9tW2pdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaS0tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbn0pKEFycmF5KTsiLCIoZnVuY3Rpb24gKG5nLCBjcmlwLCBBcnJheSwgU3RyaW5nLCBOdW1iZXIsIE1hdGgsIFJlZ0V4cCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuY29yZVxyXG4gICAgICAgIC5jb25maWcoQ29yZUNvbmZpZyk7XHJcblxyXG4gICAgQ29yZUNvbmZpZy4kaW5qZWN0ID0gW107XHJcblxyXG4gICAgZnVuY3Rpb24gQ29yZUNvbmZpZygpIHtcclxuXHJcbiAgICAgICAgbmcuZXh0ZW5kKG5nLCB7XHJcbiAgICAgICAgICAgIGlzRW1wdHk6IGlzRW1wdHksXHJcbiAgICAgICAgICAgIGhhc1ZhbHVlOiBoYXNWYWx1ZSxcclxuICAgICAgICAgICAgaGFzUHJvcGVydHk6IGhhc1Byb3BlcnR5XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIERldGVybWluZXMgaXMgdmFsdWUgZW1wdHlcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSB2YWx1ZVxyXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGZ1bmN0aW9uIGlzRW1wdHkodmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5nLmlzVW5kZWZpbmVkKHZhbHVlKSB8fCB2YWx1ZSA9PT0gJycgfHwgdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgIT09IHZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRGV0ZXJtaW5lcyBpcyB2YWx1ZSBpbiBvYmplY3RcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSB2YWx1ZVxyXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGZ1bmN0aW9uIGhhc1ZhbHVlKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAhaXNFbXB0eSh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBEZXRlcm1pbmVzIGlzIG9iamVjdCBjb250YWluaW5nIHByb3BlcnRpZXMgY2hhaW5cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvYmplY3RcclxuICAgICAgICAgKiBAcGFyYW0gey4uLnN0cmluZ30gcHJvcGVydGllc1xyXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGZ1bmN0aW9uIGhhc1Byb3BlcnR5KG9iamVjdCwgcHJvcGVydGllcykge1xyXG4gICAgICAgICAgICB2YXIgYSA9IGFyZ3VtZW50cztcclxuXHJcbiAgICAgICAgICAgIGlmIChhLmxlbmd0aCA9PT0gMCB8fCBpc0VtcHR5KGFbMF0pKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGFbMF07XHJcbiAgICAgICAgICAgIGZvciAodmFyIGFyZyBpbiBhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXJnID09PSAnMCcpXHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0YXJnZXQuaGFzT3duUHJvcGVydHkoYVthcmddKSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0W2FbYXJnXV07XHJcbiAgICAgICAgICAgICAgICBpZiAobmcuaXNVbmRlZmluZWQodGFyZ2V0KSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoYW5ndWxhciwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pLCBBcnJheSwgU3RyaW5nLCBOdW1iZXIsIE1hdGgsIFJlZ0V4cCk7IiwiKGZ1bmN0aW9uKG5nLCBjcmlwKXtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmNvcmVcclxuICAgICAgICAucnVuKEZpbGVFeHRlbnNpb25zKTtcclxuXHJcbiAgICBGaWxlRXh0ZW5zaW9ucy4kaW5qZWN0ID0gWyckd2luZG93J107XHJcblxyXG4gICAgZnVuY3Rpb24gRmlsZUV4dGVuc2lvbnMoJHdpbmRvdykge1xyXG5cclxuICAgICAgICBuZy5leHRlbmQobmcsIHtcclxuICAgICAgICAgICAgaXNGaWxlOiBpc0ZpbGUsXHJcbiAgICAgICAgICAgIGlzSW1hZ2U6IGlzSW1hZ2UsXHJcbiAgICAgICAgICAgIGlzSHRtbDU6ICEhKEZpbGUgJiYgRm9ybURhdGEpLFxyXG4gICAgICAgICAgICBmaWxlU3VwcG9ydDogISEoJHdpbmRvdy5GaWxlUmVhZGVyICYmICR3aW5kb3cuQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBEZXRlcm1pbmVzIGlzIGl0ZW0gYW4gaW5zdGFuY2Ugb2YgRmlsZVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIHsqfSBpdGVtXHJcbiAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZnVuY3Rpb24gaXNGaWxlKGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5nLmlzT2JqZWN0KGl0ZW0pICYmIGl0ZW0gaW5zdGFuY2VvZiAkd2luZG93LkZpbGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBEZXRlcm1pbmVzIGlzIGZpbGUgYW4gdHlwZSBvZiBpbWFnZVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIHtGaWxlfSBmaWxlXHJcbiAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZnVuY3Rpb24gaXNJbWFnZShmaWxlKSB7XHJcbiAgICAgICAgICAgIHZhciB0eXBlID0gJ3wnICsgZmlsZS50eXBlLnNsaWNlKGZpbGUudHlwZS5sYXN0SW5kZXhPZignLycpICsgMSkgKyAnfCc7XHJcbiAgICAgICAgICAgIHJldHVybiAnfGpwZ3xwbmd8anBlZ3xibXB8Z2lmfCcuaW5kZXhPZih0eXBlKSAhPT0gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KShhbmd1bGFyLCB3aW5kb3cuY3JpcCB8fCAod2luZG93LmNyaXAgPSB7fSkpOyIsIihmdW5jdGlvbihOdW1iZXIpe1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIE51bWJlci5wcm90b3R5cGUudG9CeXRlcyA9IHRvQnl0ZXM7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDb252ZXJ0IE51bWJlciB0byB1c2VyIGZyaWVuZGx5IGJ5dGUgc3RyaW5nXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtob2xkZXJdXHJcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiB0b0J5dGVzKGhvbGRlcikge1xyXG4gICAgICAgIGhvbGRlciA9IGhvbGRlciB8fCAoaG9sZGVyID0ge30pO1xyXG4gICAgICAgIGhvbGRlci52YWx1ZSA9IHRoaXM7XHJcbiAgICAgICAgaG9sZGVyLnNpemUgPSBNYXRoLmxvZyhob2xkZXIudmFsdWUpIC8gTWF0aC5sb2coMWUzKSB8IDA7XHJcbiAgICAgICAgaG9sZGVyLm51bSA9IChob2xkZXIudmFsdWUgLyBNYXRoLnBvdygxZTMsIGhvbGRlci5zaXplKSkudG9GaXhlZCgyKTtcclxuICAgICAgICBob2xkZXIudGV4dCA9IChob2xkZXIuc2l6ZSA/ICgna01HVFBFWlknWy0taG9sZGVyLnNpemVdICsgJ0InKSA6ICdCeXRlcycpO1xyXG5cclxuICAgICAgICByZXR1cm4gJ3tudW19IHt0ZXh0fScuc3VwcGxhbnQoaG9sZGVyKTtcclxuICAgIH1cclxufSkoTnVtYmVyKTsiLCIoZnVuY3Rpb24gKFN0cmluZykge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIFN0cmluZy5wcm90b3R5cGUuc3VwcGxhbnQgPSBzdXBwbGFudDtcclxuICAgIFN0cmluZy5wcm90b3R5cGUucmVwbGFjZUFsbCA9IHJlcGxhY2VBbGw7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBIHNpbXBsZSB0ZW1wbGF0aW5nIG1ldGhvZCBmb3IgcmVwbGFjaW5nIHBsYWNlaG9sZGVycyBlbmNsb3NlZCBpbiBjdXJseSBicmFjZXMuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IG9cclxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIHN1cHBsYW50KG8pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC97KFtee31dKil9L2csXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgciA9IG9bYl07XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHIgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiByID09PSAnbnVtYmVyJyA/IHIgOiBhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlcGxhY2UgYWxsIG9jY3VycmVuY2VzIGluIHN0cmluZ1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzZWFyY2hWYWx1ZSBVc2VkIGluIFJlZ0V4cFxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd8ZnVuY3Rpb259IHJlcGxhY2VWYWx1ZVxyXG4gICAgICogQHJldHVybnMge3N0cmluZ31cclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gcmVwbGFjZUFsbChzZWFyY2hWYWx1ZSwgcmVwbGFjZVZhbHVlKSB7XHJcbiAgICAgICAgdmFyIHRhcmdldCA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIHRhcmdldC5yZXBsYWNlKG5ldyBSZWdFeHAoc2VhcmNoVmFsdWUsICdnJyksIHJlcGxhY2VWYWx1ZSk7XHJcbiAgICB9XHJcblxyXG59KShTdHJpbmcpOyIsIihmdW5jdGlvbiAobmcsIGNyaXApIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmNvcmVcclxuICAgICAgICAuZGlyZWN0aXZlKCdjcmlwQ29udGV4dG1lbnUnLCBjcmlwQ29udGV4dG1lbnUpO1xyXG5cclxuICAgIGNyaXBDb250ZXh0bWVudS4kaW5qZWN0ID0gWyckcGFyc2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBjcmlwQ29udGV4dG1lbnUoJHBhcnNlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgbGluazogbGlua1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgIHZhciBmbiA9ICRwYXJzZShhdHRycy5jcmlwQ29udGV4dG1lbnUpO1xyXG4gICAgICAgICAgICBlbGVtZW50LmJpbmQoXCJjb250ZXh0bWVudVwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZuKHNjb3BlLCB7JGV2ZW50OmV2ZW50LCAkZWxlbWVudDogZWxlbWVudH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gUmVtb3ZlcyBib3VuZCBldmVudHMgaW4gdGhlIGVsZW1lbnQgaXRzZWxmXHJcbiAgICAgICAgICAgIC8vIHdoZW4gdGhlIHNjb3BlIGlzIGRlc3Ryb3llZFxyXG4gICAgICAgICAgICBzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5vZmYoYXR0cnMuY3JpcENvbnRleHRtZW51KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KShhbmd1bGFyLCB3aW5kb3cuY3JpcCB8fCAod2luZG93LmNyaXAgPSB7fSkpO1xyXG4iLCIoZnVuY3Rpb24gKG5nLCBjcmlwKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5jb3JlXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnY3JpcEVudGVyJywgY3JpcEVudGVyKTtcclxuXHJcbiAgICBjcmlwRW50ZXIuJGluamVjdCA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNyaXBFbnRlcigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICBsaW5rOiBsaW5rXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgZWxlbWVudC5iaW5kKFwia2V5ZG93biBrZXlwcmVzc1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChldmVudC53aGljaCA9PT0gMTMpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kZXZhbChhdHRycy5jcmlwRW50ZXIsIHsnZXZlbnQnOiBldmVudH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJlbW92ZXMgYm91bmQgZXZlbnRzIGluIHRoZSBlbGVtZW50IGl0c2VsZlxyXG4gICAgICAgICAgICAvLyB3aGVuIHRoZSBzY29wZSBpcyBkZXN0cm95ZWRcclxuICAgICAgICAgICAgc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQub2ZmKGF0dHJzLmNyaXBFbnRlcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoYW5ndWxhciwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pKTtcclxuIiwiKGZ1bmN0aW9uIChjcmlwKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5jb3JlXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnY3JpcEZvY3VzJywgY3JpcEZvY3VzKTtcclxuXHJcbiAgICBjcmlwRm9jdXMuJGluamVjdCA9IFsnZm9jdXMnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBjcmlwRm9jdXMoZm9jdXMpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICBsaW5rOiBsaW5rXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgZWxlbWVudC5vbihhdHRycy5jcmlwRm9jdXMsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGZvY3VzKGF0dHJzLmNyaXBTZWxlY3Rvcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gUmVtb3ZlcyBib3VuZCBldmVudHMgaW4gdGhlIGVsZW1lbnQgaXRzZWxmXHJcbiAgICAgICAgICAgIC8vIHdoZW4gdGhlIHNjb3BlIGlzIGRlc3Ryb3llZFxyXG4gICAgICAgICAgICBzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5vZmYoYXR0cnMuY3JpcEZvY3VzKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSh3aW5kb3cuY3JpcCB8fCAod2luZG93LmNyaXAgPSB7fSkpOyIsIihmdW5jdGlvbiAobmcsIGNyaXApIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmNvcmVcclxuICAgICAgICAuZGlyZWN0aXZlKCdjcmlwVGh1bWInLCBjcmlwVGh1bWIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNyaXBUaHVtYigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxjYW52YXMvPicsXHJcbiAgICAgICAgICAgIGxpbms6IGxpbmtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XHJcbiAgICAgICAgICAgIGlmKCFuZy5maWxlU3VwcG9ydCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHNjb3BlLiRldmFsKGF0dHJzLmNyaXBUaHVtYik7XHJcblxyXG4gICAgICAgICAgICBpZiAoIW5nLmlzRmlsZShwYXJhbXMuZmlsZSkgfHwgIW5nLmlzSW1hZ2UocGFyYW1zLmZpbGUpKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmhpZGUoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIGNhbnZhcyA9IGVsZW1lbnQuZmluZCgnY2FudmFzJyk7XHJcbiAgICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG5cclxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IG9uTG9hZEZpbGU7XHJcbiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKHBhcmFtcy5maWxlKTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uTG9hZEZpbGUoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSBvbkxvYWRJbWFnZTtcclxuICAgICAgICAgICAgICAgIGltZy5zcmMgPSBldmVudC50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBvbkxvYWRJbWFnZSgpIHtcclxuICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IHBhcmFtcy53aWR0aCB8fCB0aGlzLndpZHRoIC8gdGhpcy5oZWlnaHQgKiBwYXJhbXMuaGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IHBhcmFtcy5oZWlnaHQgfHwgdGhpcy5oZWlnaHQgLyB0aGlzLndpZHRoICogcGFyYW1zLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgY2FudmFzLmF0dHIoe3dpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHR9KTtcclxuICAgICAgICAgICAgICAgIGNhbnZhc1swXS5nZXRDb250ZXh0KCcyZCcpLmRyYXdJbWFnZSh0aGlzLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKGFuZ3VsYXIsIHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSk7IiwiKGZ1bmN0aW9uICgkLCBjcmlwKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5jb3JlXHJcbiAgICAgICAgLmZhY3RvcnkoJ2ZvY3VzJywgZm9jdXMpO1xyXG5cclxuICAgIGZvY3VzLiRpbmplY3QgPSBbJyR0aW1lb3V0J107XHJcblxyXG4gICAgZnVuY3Rpb24gZm9jdXMoJHRpbWVvdXQpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHNlbGVjdG9yLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAvLyB0aW1lb3V0IG1ha2VzIHN1cmUgdGhhdCBpdCBpcyBpbnZva2VkIGFmdGVyIGFueSBvdGhlciBldmVudCBoYXMgYmVlbiB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgIC8vIGUuZy4gY2xpY2sgZXZlbnRzIHRoYXQgbmVlZCB0byBydW4gYmVmb3JlIHRoZSBmb2N1cyBvclxyXG4gICAgICAgICAgICAvLyBpbnB1dHMgZWxlbWVudHMgdGhhdCBhcmUgaW4gYSBkaXNhYmxlZCBzdGF0ZSBidXQgYXJlIGVuYWJsZWQgd2hlbiB0aG9zZSBldmVudHNcclxuICAgICAgICAgICAgLy8gYXJlIHRyaWdnZXJlZC5cclxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyICRlbGVtZW50ID0gJChzZWxlY3Rvcik7XHJcbiAgICAgICAgICAgICAgICBpZiAoJGVsZW1lbnQubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQuZm9jdXMoY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KShqUXVlcnksIHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSk7IiwiKGZ1bmN0aW9uIChjcmlwLCBNYXRoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5jb3JlXHJcbiAgICAgICAgLnNlcnZpY2UoJ2NyaXBTdHJSYW5kb20nLCBjcmlwU3RyUmFuZG9tKTtcclxuXHJcbiAgICBjcmlwU3RyUmFuZG9tLiRpbmplY3QgPSBbXTtcclxuXHJcbiAgICBmdW5jdGlvbiBjcmlwU3RyUmFuZG9tKCkge1xyXG4gICAgICAgIHZhciBwb3NzaWJsZSA9ICctX0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Xy0nO1xyXG5cclxuICAgICAgICB0aGlzLmNoYW5nZUNoYXJzID0gZnVuY3Rpb24gKGNoYXJzKSB7XHJcbiAgICAgICAgICAgIHBvc3NpYmxlID0gY2hhcnM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5uZXcgPSBmdW5jdGlvbiAobGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxlbmd0aCB8PSAxNjtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9ICcnO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gcG9zc2libGUuY2hhckF0KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHBvc3NpYmxlLmxlbmd0aCkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0pKHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSwgTWF0aCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
