!function(i,t){"use strict";t.core=i.module("crip.core",[])}(angular,window.crip||(window.crip={})),function(i,t,n,e,r){"use strict";function o(){function t(i){return this.filter(function(t){return i.indexOf(t)<0})}function o(i,t){for(var n=this.length-1;n>=0;n--)"undefined"==typeof t?this[n]==i&&this.splice(n,1):this[n][t]==i&&this.splice(n,1)}function c(t){return i.isUndefined(t)||""===t||null===t||t!==t}function u(i){return!c(i)}function s(){var t=arguments;if(0===t.length||c(t[0]))return!1;var n=t[0];for(var e in t)if("0"!==e){if(!n.hasOwnProperty(t[e]))return!1;if(n=n[t[e]],i.isUndefined(n))return!1}return!0}function f(i){return this.replace(/{([^{}]*)}/g,function(t,n){var e=i[n];return"string"==typeof e||"number"==typeof e?e:t})}function a(){return this.value=this,this.size=Math.log(this)/Math.log(1e3)|0,this.num=(this/Math.pow(1e3,this.size)).toFixed(2),this.text=this.size?"kMGTPEZY"[--this.size]+"B":"Bytes","{num} {text}".supplant(this)}n.prototype.diff=t,n.prototype.removeItem=o,e.prototype.supplant=f,r.prototype.toBytes=a,i.extend(i,{isEmpty:c,hasValue:u,hasProperty:s})}t.core.config(o),o.$inject=[]}(angular,window.crip||(window.crip={}),Array,String,Number),function(i,t){"use strict";function n(t){function n(n){return i.isObject(n)&&n instanceof t.File}function e(i){var t="|"+i.type.slice(i.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(t)}i.extend(i,{isFile:n,isImage:e,fileSupport:!(!t.FileReader||!t.CanvasRenderingContext2D)})}t.core.run(n),n.$inject=["$window"]}(angular,window.crip||(window.crip={})),function(i,t){"use strict";function n(){function i(i,t,n,e){t.bind("keydown keypress",function(t){13===t.which&&(i.$apply(function(){i.$eval(n.cripEnter,{event:t})}),t.preventDefault())}),i.$on("$destroy",function(){t.off(n.cripEnter)})}return{restrict:"A",link:i}}t.core.directive("cripEnter",n),n.$inject=[]}(angular,window.crip||(window.crip={})),function(i){"use strict";function t(i){function t(t,n,e,r){n.on(e.cripFocus,function(){i(e.cripSelector)}),t.$on("$destroy",function(){n.off(e.cripFocus)})}return{restrict:"A",link:t}}i.core.directive("cripFocus",t),t.$inject=["focus"]}(window.crip||(window.crip={})),function(i,t){"use strict";function n(){function t(t,n,e){function r(i){var t=new Image;t.onload=o,t.src=i.target.result}function o(){var i=c.width||this.width/this.height*c.height,t=c.height||this.height/this.width*c.width;u.attr({width:i,height:t}),u[0].getContext("2d").drawImage(this,0,0,i,t)}if(i.fileSupport){var c=t.$eval(e.cripThumb);if(!i.isFile(c.file)||!i.isImage(c.file))return void n.hide();var u=n.find("canvas"),s=new FileReader;s.onload=r,s.readAsDataURL(c.file)}}return{restrict:"A",template:"<canvas/>",link:t}}t.core.directive("cripThumb",n)}(angular,window.crip||(window.crip={})),function(i,t){"use strict";function n(t){return function(n,e){t(function(){var t=i(n);1===t.length&&("function"==typeof e?t.focus(e):t.focus())})}}t.core.factory("focus",n),n.$inject=["$timeout"]}(jQuery,window.crip||(window.crip={})),function(i,t){"use strict";function n(){var i="-_ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-";this.changeChars=function(t){i=t},this["new"]=function(n){n|=16;for(var e="",r=0;n>r;r++)e+=i.charAt(t.floor(t.random()*i.length));return e}}i.core.service("cripStrRandom",n),n.$inject=[]}(window.crip||(window.crip={}),Math);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9zb3VyY2UvY29yZS5tb2R1bGUuanMiLCIvc291cmNlL2NvbmZpZy5qcyIsIi9zb3VyY2UvZmlsZS5leHRlbnNpb25zLmpzIiwiL3NvdXJjZS9kaXJlY3RpdmVzL2NyaXBFbnRlci5qcyIsIi9zb3VyY2UvZGlyZWN0aXZlcy9jcmlwRm9jdXMuanMiLCIvc291cmNlL2RpcmVjdGl2ZXMvY3JpcFRodW1iLmpzIiwiL3NvdXJjZS9mYWN0b3JpZXMvZm9jdXMuanMiLCIvc291cmNlL3NlcnZpY2VzL2NyaXBTdHJSYW5kb20uanMiXSwibmFtZXMiOlsibmciLCJjcmlwIiwiY29yZSIsIm1vZHVsZSIsImFuZ3VsYXIiLCJ3aW5kb3ciLCJBcnJheSIsIlN0cmluZyIsIk51bWJlciIsIkNvcmVDb25maWciLCJkaWZmIiwiYSIsInRoaXMiLCJmaWx0ZXIiLCJpIiwiaW5kZXhPZiIsInJlbW92ZUl0ZW0iLCJ2YWwiLCJrZXkiLCJsZW5ndGgiLCJzcGxpY2UiLCJpc0VtcHR5IiwidmFsdWUiLCJpc1VuZGVmaW5lZCIsImhhc1ZhbHVlIiwiaGFzUHJvcGVydHkiLCJhcmd1bWVudHMiLCJ0YXJnZXQiLCJhcmciLCJoYXNPd25Qcm9wZXJ0eSIsInN1cHBsYW50IiwibyIsInJlcGxhY2UiLCJiIiwiciIsInRvQnl0ZXMiLCJzaXplIiwiTWF0aCIsImxvZyIsIm51bSIsInBvdyIsInRvRml4ZWQiLCJ0ZXh0IiwicHJvdG90eXBlIiwiZXh0ZW5kIiwiY29uZmlnIiwiJGluamVjdCIsIkZpbGVFeHRlbnNpb25zIiwiJHdpbmRvdyIsImlzRmlsZSIsIml0ZW0iLCJpc09iamVjdCIsIkZpbGUiLCJpc0ltYWdlIiwiZmlsZSIsInR5cGUiLCJzbGljZSIsImxhc3RJbmRleE9mIiwiZmlsZVN1cHBvcnQiLCJGaWxlUmVhZGVyIiwiQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIiwicnVuIiwiY3JpcEVudGVyIiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiY3RybCIsImJpbmQiLCJldmVudCIsIndoaWNoIiwiJGFwcGx5IiwiJGV2YWwiLCJwcmV2ZW50RGVmYXVsdCIsIiRvbiIsIm9mZiIsInJlc3RyaWN0IiwiZGlyZWN0aXZlIiwiY3JpcEZvY3VzIiwiZm9jdXMiLCJvbiIsImNyaXBTZWxlY3RvciIsImNyaXBUaHVtYiIsIm9uTG9hZEZpbGUiLCJpbWciLCJJbWFnZSIsIm9ubG9hZCIsIm9uTG9hZEltYWdlIiwic3JjIiwicmVzdWx0Iiwid2lkdGgiLCJwYXJhbXMiLCJoZWlnaHQiLCJjYW52YXMiLCJhdHRyIiwiZ2V0Q29udGV4dCIsImRyYXdJbWFnZSIsImhpZGUiLCJmaW5kIiwicmVhZGVyIiwicmVhZEFzRGF0YVVSTCIsInRlbXBsYXRlIiwiJCIsIiR0aW1lb3V0Iiwic2VsZWN0b3IiLCJjYWxsYmFjayIsIiRlbGVtZW50IiwiZmFjdG9yeSIsImpRdWVyeSIsImNyaXBTdHJSYW5kb20iLCJwb3NzaWJsZSIsImNoYW5nZUNoYXJzIiwiY2hhcnMiLCJjaGFyQXQiLCJmbG9vciIsInJhbmRvbSIsInNlcnZpY2UiXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsWUFFQUEsR0FBQUMsS0FBQUYsRUFBQUcsT0FBQSxpQkFFQUMsUUFBQUMsT0FBQUosT0FBQUksT0FBQUosVUNMQSxTQUFBRCxFQUFBQyxFQUFBSyxFQUFBQyxFQUFBQyxHQUNBLFlBT0EsU0FBQUMsS0FhQSxRQUFBQyxHQUFBQyxHQUNBLE1BQUFDLE1BQUFDLE9BQUEsU0FBQUMsR0FDQSxNQUFBSCxHQUFBSSxRQUFBRCxHQUFBLElBSUEsUUFBQUUsR0FBQUMsRUFBQUMsR0FDQSxJQUFBLEdBQUFKLEdBQUFGLEtBQUFPLE9BQUEsRUFBQUwsR0FBQSxFQUFBQSxJQUNBLG1CQUFBSSxHQUNBTixLQUFBRSxJQUFBRyxHQUNBTCxLQUFBUSxPQUFBTixFQUFBLEdBRUFGLEtBQUFFLEdBQUFJLElBQUFELEdBQ0FMLEtBQUFRLE9BQUFOLEVBQUEsR0FJQSxRQUFBTyxHQUFBQyxHQUNBLE1BQUF0QixHQUFB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QyxHQUtBRixFQUFBLFdBQ0EsR0FBQUcsR0FBQUosRUFBQUUsRUFDQSxLQUFBRSxFQUFBdkYsU0FDQSxrQkFBQXNGLEdBQ0FDLEVBQUEzQixNQUFBMEIsR0FFQUMsRUFBQTNCLFlBakJBOUUsRUFBQUMsS0FDQXlHLFFBQUEsUUFBQTVCLEdBRUFBLEVBQUFqQyxTQUFBLGFBbUJBOEQsT0FBQXZHLE9BQUFKLE9BQUFJLE9BQUFKLFVDekJBLFNBQUFBLEVBQUFvQyxHQUNBLFlBT0EsU0FBQXdFLEtBQ0EsR0FBQUMsR0FBQSxvRUFFQWxHLE1BQUFtRyxZQUFBLFNBQUFDLEdBQ0FGLEVBQUFFLEdBR0FwRyxLQUFBQSxPQUFBLFNBQUFPLEdBQ0FBLEdBQUEsRUFFQSxLQUFBLEdBREFzRSxHQUFBLEdBQ0EzRSxFQUFBLEVBQUFLLEVBQUFMLEVBQUFBLElBQ0EyRSxHQUFBcUIsRUFBQUcsT0FBQTVFLEVBQUE2RSxNQUFBN0UsRUFBQThFLFNBQUFMLEVBQUEzRixRQUdBLE9BQUFzRSxJQW5CQXhGLEVBQUFDLEtBQ0FrSCxRQUFBLGdCQUFBUCxHQUVBQSxFQUFBL0QsWUFtQkF6QyxPQUFBSixPQUFBSSxPQUFBSixTQUFBb0MiLCJmaWxlIjoiY3JpcC1jb3JlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAobmcsIGNyaXApIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmNvcmUgPSBuZy5tb2R1bGUoJ2NyaXAuY29yZScsIFtdKTtcclxuXHJcbn0pKGFuZ3VsYXIsIHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSk7IiwiKGZ1bmN0aW9uIChuZywgY3JpcCwgQXJyYXksIFN0cmluZywgTnVtYmVyKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5jb3JlXHJcbiAgICAgICAgLmNvbmZpZyhDb3JlQ29uZmlnKTtcclxuXHJcbiAgICBDb3JlQ29uZmlnLiRpbmplY3QgPSBbXTtcclxuXHJcbiAgICBmdW5jdGlvbiBDb3JlQ29uZmlnKCkge1xyXG4gICAgICAgIEFycmF5LnByb3RvdHlwZS5kaWZmID0gZGlmZjtcclxuICAgICAgICBBcnJheS5wcm90b3R5cGUucmVtb3ZlSXRlbSA9IHJlbW92ZUl0ZW07XHJcblxyXG4gICAgICAgIFN0cmluZy5wcm90b3R5cGUuc3VwcGxhbnQgPSBzdXBwbGFudDtcclxuICAgICAgICBOdW1iZXIucHJvdG90eXBlLnRvQnl0ZXMgPSB0b0J5dGVzO1xyXG5cclxuICAgICAgICBuZy5leHRlbmQobmcsIHtcclxuICAgICAgICAgICAgaXNFbXB0eTogaXNFbXB0eSxcclxuICAgICAgICAgICAgaGFzVmFsdWU6IGhhc1ZhbHVlLFxyXG4gICAgICAgICAgICBoYXNQcm9wZXJ0eTogaGFzUHJvcGVydHlcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZGlmZihhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbiAoaSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGEuaW5kZXhPZihpKSA8IDA7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlSXRlbSh2YWwsIGtleSkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBrZXkgPT09IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpc1tpXSA9PSB2YWwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpc1tpXVtrZXldID09IHZhbClcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNFbXB0eSh2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmcuaXNVbmRlZmluZWQodmFsdWUpIHx8IHZhbHVlID09PSAnJyB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSAhPT0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoYXNWYWx1ZSh2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gIWlzRW1wdHkodmFsdWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGFzUHJvcGVydHkoKSB7XHJcbiAgICAgICAgICAgIHZhciBhID0gYXJndW1lbnRzO1xyXG5cclxuICAgICAgICAgICAgaWYgKGEubGVuZ3RoID09PSAwIHx8IGlzRW1wdHkoYVswXSkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gYVswXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgYXJnIGluIGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhcmcgPT09ICcwJylcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRhcmdldC5oYXNPd25Qcm9wZXJ0eShhW2FyZ10pKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXRbYVthcmddXTtcclxuICAgICAgICAgICAgICAgIGlmIChuZy5pc1VuZGVmaW5lZCh0YXJnZXQpKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBBIHNpbXBsZSB0ZW1wbGF0aW5nIG1ldGhvZCBmb3IgcmVwbGFjaW5nIHBsYWNlaG9sZGVycyBlbmNsb3NlZCBpbiBjdXJseSBicmFjZXMuXHJcbiAgICAgICAgZnVuY3Rpb24gc3VwcGxhbnQobykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC97KFtee31dKil9L2csXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByID0gb1tiXTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHIgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiByID09PSAnbnVtYmVyJyA/IHIgOiBhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ29udmVydCBOdW1iZXIgdG8gdXNlciBmcmllbmRseSBzdHJpbmdcclxuICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGZ1bmN0aW9uIHRvQnl0ZXMoKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzO1xyXG4gICAgICAgICAgICB0aGlzLnNpemUgPSBNYXRoLmxvZyh0aGlzKSAvIE1hdGgubG9nKDFlMykgfCAwO1xyXG4gICAgICAgICAgICB0aGlzLm51bSA9ICh0aGlzIC8gTWF0aC5wb3coMWUzLCB0aGlzLnNpemUpKS50b0ZpeGVkKDIpO1xyXG4gICAgICAgICAgICB0aGlzLnRleHQgPSAodGhpcy5zaXplID8gKCdrTUdUUEVaWSdbLS10aGlzLnNpemVdICsgJ0InKSA6ICdCeXRlcycpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuICd7bnVtfSB7dGV4dH0nLnN1cHBsYW50KHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoYW5ndWxhciwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pLCBBcnJheSwgU3RyaW5nLCBOdW1iZXIpOyIsIihmdW5jdGlvbihuZywgY3JpcCl7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5jb3JlXHJcbiAgICAgICAgLnJ1bihGaWxlRXh0ZW5zaW9ucyk7XHJcblxyXG4gICAgRmlsZUV4dGVuc2lvbnMuJGluamVjdCA9IFsnJHdpbmRvdyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIEZpbGVFeHRlbnNpb25zKCR3aW5kb3cpIHtcclxuXHJcbiAgICAgICAgbmcuZXh0ZW5kKG5nLCB7XHJcbiAgICAgICAgICAgIGlzRmlsZTogaXNGaWxlLFxyXG4gICAgICAgICAgICBpc0ltYWdlOiBpc0ltYWdlLFxyXG4gICAgICAgICAgICBmaWxlU3VwcG9ydDogISEoJHdpbmRvdy5GaWxlUmVhZGVyICYmICR3aW5kb3cuQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0ZpbGUoaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmcuaXNPYmplY3QoaXRlbSkgJiYgaXRlbSBpbnN0YW5jZW9mICR3aW5kb3cuRmlsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzSW1hZ2UoZmlsZSkge1xyXG4gICAgICAgICAgICB2YXIgdHlwZSA9ICd8JyArIGZpbGUudHlwZS5zbGljZShmaWxlLnR5cGUubGFzdEluZGV4T2YoJy8nKSArIDEpICsgJ3wnO1xyXG4gICAgICAgICAgICByZXR1cm4gJ3xqcGd8cG5nfGpwZWd8Ym1wfGdpZnwnLmluZGV4T2YodHlwZSkgIT09IC0xO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoYW5ndWxhciwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pKTsiLCIoZnVuY3Rpb24gKG5nLCBjcmlwKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5jb3JlXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnY3JpcEVudGVyJywgY3JpcEVudGVyKTtcclxuXHJcbiAgICBjcmlwRW50ZXIuJGluamVjdCA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNyaXBFbnRlcigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICBsaW5rOiBsaW5rXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgZWxlbWVudC5iaW5kKFwia2V5ZG93biBrZXlwcmVzc1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChldmVudC53aGljaCA9PT0gMTMpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kZXZhbChhdHRycy5jcmlwRW50ZXIsIHsnZXZlbnQnOiBldmVudH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJlbW92ZXMgYm91bmQgZXZlbnRzIGluIHRoZSBlbGVtZW50IGl0c2VsZlxyXG4gICAgICAgICAgICAvLyB3aGVuIHRoZSBzY29wZSBpcyBkZXN0cm95ZWRcclxuICAgICAgICAgICAgc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQub2ZmKGF0dHJzLmNyaXBFbnRlcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoYW5ndWxhciwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pKTtcclxuIiwiKGZ1bmN0aW9uIChjcmlwKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5jb3JlXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnY3JpcEZvY3VzJywgY3JpcEZvY3VzKTtcclxuXHJcbiAgICBjcmlwRm9jdXMuJGluamVjdCA9IFsnZm9jdXMnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBjcmlwRm9jdXMoZm9jdXMpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICBsaW5rOiBsaW5rXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgZWxlbWVudC5vbihhdHRycy5jcmlwRm9jdXMsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGZvY3VzKGF0dHJzLmNyaXBTZWxlY3Rvcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gUmVtb3ZlcyBib3VuZCBldmVudHMgaW4gdGhlIGVsZW1lbnQgaXRzZWxmXHJcbiAgICAgICAgICAgIC8vIHdoZW4gdGhlIHNjb3BlIGlzIGRlc3Ryb3llZFxyXG4gICAgICAgICAgICBzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5vZmYoYXR0cnMuY3JpcEZvY3VzKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSh3aW5kb3cuY3JpcCB8fCAod2luZG93LmNyaXAgPSB7fSkpOyIsIihmdW5jdGlvbiAobmcsIGNyaXApIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmNvcmVcclxuICAgICAgICAuZGlyZWN0aXZlKCdjcmlwVGh1bWInLCBjcmlwVGh1bWIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNyaXBUaHVtYigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxjYW52YXMvPicsXHJcbiAgICAgICAgICAgIGxpbms6IGxpbmtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XHJcbiAgICAgICAgICAgIGlmKCFuZy5maWxlU3VwcG9ydCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHNjb3BlLiRldmFsKGF0dHJzLmNyaXBUaHVtYik7XHJcblxyXG4gICAgICAgICAgICBpZiAoIW5nLmlzRmlsZShwYXJhbXMuZmlsZSkgfHwgIW5nLmlzSW1hZ2UocGFyYW1zLmZpbGUpKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmhpZGUoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIGNhbnZhcyA9IGVsZW1lbnQuZmluZCgnY2FudmFzJyk7XHJcbiAgICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG5cclxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IG9uTG9hZEZpbGU7XHJcbiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKHBhcmFtcy5maWxlKTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uTG9hZEZpbGUoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSBvbkxvYWRJbWFnZTtcclxuICAgICAgICAgICAgICAgIGltZy5zcmMgPSBldmVudC50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBvbkxvYWRJbWFnZSgpIHtcclxuICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IHBhcmFtcy53aWR0aCB8fCB0aGlzLndpZHRoIC8gdGhpcy5oZWlnaHQgKiBwYXJhbXMuaGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IHBhcmFtcy5oZWlnaHQgfHwgdGhpcy5oZWlnaHQgLyB0aGlzLndpZHRoICogcGFyYW1zLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgY2FudmFzLmF0dHIoe3dpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHR9KTtcclxuICAgICAgICAgICAgICAgIGNhbnZhc1swXS5nZXRDb250ZXh0KCcyZCcpLmRyYXdJbWFnZSh0aGlzLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKGFuZ3VsYXIsIHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSk7IiwiKGZ1bmN0aW9uICgkLCBjcmlwKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5jb3JlXHJcbiAgICAgICAgLmZhY3RvcnkoJ2ZvY3VzJywgZm9jdXMpO1xyXG5cclxuICAgIGZvY3VzLiRpbmplY3QgPSBbJyR0aW1lb3V0J107XHJcblxyXG4gICAgZnVuY3Rpb24gZm9jdXMoJHRpbWVvdXQpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHNlbGVjdG9yLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAvLyB0aW1lb3V0IG1ha2VzIHN1cmUgdGhhdCBpdCBpcyBpbnZva2VkIGFmdGVyIGFueSBvdGhlciBldmVudCBoYXMgYmVlbiB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgIC8vIGUuZy4gY2xpY2sgZXZlbnRzIHRoYXQgbmVlZCB0byBydW4gYmVmb3JlIHRoZSBmb2N1cyBvclxyXG4gICAgICAgICAgICAvLyBpbnB1dHMgZWxlbWVudHMgdGhhdCBhcmUgaW4gYSBkaXNhYmxlZCBzdGF0ZSBidXQgYXJlIGVuYWJsZWQgd2hlbiB0aG9zZSBldmVudHNcclxuICAgICAgICAgICAgLy8gYXJlIHRyaWdnZXJlZC5cclxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyICRlbGVtZW50ID0gJChzZWxlY3Rvcik7XHJcbiAgICAgICAgICAgICAgICBpZiAoJGVsZW1lbnQubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQuZm9jdXMoY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KShqUXVlcnksIHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSk7IiwiKGZ1bmN0aW9uIChjcmlwLCBNYXRoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5jb3JlXHJcbiAgICAgICAgLnNlcnZpY2UoJ2NyaXBTdHJSYW5kb20nLCBjcmlwU3RyUmFuZG9tKTtcclxuXHJcbiAgICBjcmlwU3RyUmFuZG9tLiRpbmplY3QgPSBbXTtcclxuXHJcbiAgICBmdW5jdGlvbiBjcmlwU3RyUmFuZG9tKCkge1xyXG4gICAgICAgIHZhciBwb3NzaWJsZSA9ICctX0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Xy0nO1xyXG5cclxuICAgICAgICB0aGlzLmNoYW5nZUNoYXJzID0gZnVuY3Rpb24gKGNoYXJzKSB7XHJcbiAgICAgICAgICAgIHBvc3NpYmxlID0gY2hhcnM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5uZXcgPSBmdW5jdGlvbiAobGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxlbmd0aCB8PSAxNjtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9ICcnO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gcG9zc2libGUuY2hhckF0KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHBvc3NpYmxlLmxlbmd0aCkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0pKHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSwgTWF0aCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
