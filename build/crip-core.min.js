!function(t,n){"use strict";n.core=t.module("crip.core",[])}(angular,window.crip||(window.crip={})),function(t){"use strict";function n(t){return this.filter(function(n){return t.indexOf(n)<0})}function i(t,n){if("undefined"==typeof n)return void this.splice(this.indexOf(t)||this.length,1);for(var i=this.length-1;i>=0;i--)this[i][n]==t&&this.splice(i,1)}function e(t){var n=arguments;"undefined"==typeof t&&(n=[void 0,"",null,NAN]);for(var i=0;this.length;i++)for(var e=0;n.length;e++)this[i]===n[e]&&(this.splice(i,1),i--);return this}t.prototype.diff=n,t.prototype.removeItem=i,t.prototype.clean=e}(Array),function(t,n,i,e,r,o,c){"use strict";function u(){function n(n){return t.isUndefined(n)||""===n||null===n||n!==n}function i(t){return!n(t)}function e(i,e){var r=arguments;if(0===r.length||n(r[0]))return!1;var o=r[0];for(var c in r)if("0"!==c){if(!o.hasOwnProperty(r[c]))return!1;if(o=o[r[c]],t.isUndefined(o))return!1}return!0}t.extend(t,{isEmpty:n,hasValue:i,hasProperty:e})}n.core.config(u),u.$inject=[]}(angular,window.crip||(window.crip={}),Array,String,Number,Math,RegExp),function(t,n){"use strict";function i(n){function i(i){return t.isObject(i)&&i instanceof n.File}function e(t){var n="|"+t.type.slice(t.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(n)}t.extend(t,{isFile:i,isImage:e,fileSupport:!(!n.FileReader||!n.CanvasRenderingContext2D)})}n.core.run(i),i.$inject=["$window"]}(angular,window.crip||(window.crip={})),function(t){"use strict";function n(t){return t=t||(t={}),t.value=this,t.size=Math.log(t.value)/Math.log(1e3)|0,t.num=(t.value/Math.pow(1e3,t.size)).toFixed(2),t.text=t.size?"kMGTPEZY"[--t.size]+"B":"Bytes","{num} {text}".supplant(t)}t.prototype.toBytes=n}(Number),function(t){"use strict";function n(t){return this.replace(/{([^{}]*)}/g,function(n,i){var e=t[i];return"string"==typeof e||"number"==typeof e?e:n})}function i(t,n){var i=this;return i.replace(new RegExp(t,"g"),n)}t.prototype.supplant=n,t.prototype.replaceAll=i}(String),function(t,n){"use strict";function i(){function t(t,n,i,e){n.bind("keydown keypress",function(n){13===n.which&&(t.$apply(function(){t.$eval(i.cripEnter,{event:n})}),n.preventDefault())}),t.$on("$destroy",function(){n.off(i.cripEnter)})}return{restrict:"A",link:t}}n.core.directive("cripEnter",i),i.$inject=[]}(angular,window.crip||(window.crip={})),function(t){"use strict";function n(t){function n(n,i,e,r){i.on(e.cripFocus,function(){t(e.cripSelector)}),n.$on("$destroy",function(){i.off(e.cripFocus)})}return{restrict:"A",link:n}}t.core.directive("cripFocus",n),n.$inject=["focus"]}(window.crip||(window.crip={})),function(t,n){"use strict";function i(){function n(n,i,e){function r(t){var n=new Image;n.onload=o,n.src=t.target.result}function o(){var t=c.width||this.width/this.height*c.height,n=c.height||this.height/this.width*c.width;u.attr({width:t,height:n}),u[0].getContext("2d").drawImage(this,0,0,t,n)}if(t.fileSupport){var c=n.$eval(e.cripThumb);if(!t.isFile(c.file)||!t.isImage(c.file))return void i.hide();var u=i.find("canvas"),f=new FileReader;f.onload=r,f.readAsDataURL(c.file)}}return{restrict:"A",template:"<canvas/>",link:n}}n.core.directive("cripThumb",i)}(angular,window.crip||(window.crip={})),function(t,n){"use strict";function i(n){return function(i,e){n(function(){var n=t(i);1===n.length&&("function"==typeof e?n.focus(e):n.focus())})}}n.core.factory("focus",i),i.$inject=["$timeout"]}(jQuery,window.crip||(window.crip={})),function(t,n){"use strict";function i(){var t="-_ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-";this.changeChars=function(n){t=n},this["new"]=function(i){i|=16;for(var e="",r=0;i>r;r++)e+=t.charAt(n.floor(n.random()*t.length));return e}}t.core.service("cripStrRandom",i),i.$inject=[]}(window.crip||(window.crip={}),Math);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9zb3VyY2UvY29yZS5tb2R1bGUuanMiLCIvc291cmNlL2FycmF5LmV4dGVuc2lvbnMuanMiLCIvc291cmNlL2NvbmZpZy5qcyIsIi9zb3VyY2UvZmlsZS5leHRlbnNpb25zLmpzIiwiL3NvdXJjZS9udW1iZXIuZXh0ZW5zaW9ucy5qcyIsIi9zb3VyY2Uvc3RyaW5nLmV4dGVuc2lvbnMuanMiLCIvc291cmNlL2RpcmVjdGl2ZXMvY3JpcEVudGVyLmpzIiwiL3NvdXJjZS9kaXJlY3RpdmVzL2NyaXBGb2N1cy5qcyIsIi9zb3VyY2UvZGlyZWN0aXZlcy9jcmlwVGh1bWIuanMiLCIvc291cmNlL2ZhY3Rvcmllcy9mb2N1cy5qcyIsIi9zb3VyY2Uvc2VydmljZXMvY3JpcFN0clJhbmRvbS5qcyJdLCJuYW1lcyI6WyJuZyIsImNyaXAiLCJjb3JlIiwibW9kdWxlIiwiYW5ndWxhciIsIndpbmRvdyIsIkFycmF5IiwiZGlmZiIsImEiLCJ0aGlzIiwiZmlsdGVyIiwiaSIsImluZGV4T2YiLCJyZW1vdmVJdGVtIiwidmFsIiwia2V5Iiwic3BsaWNlIiwibGVuZ3RoIiwiY2xlYW4iLCJkZWxldGVfdmFsdWUiLCJjbGVhbl9mcm9tIiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwiTkFOIiwiaiIsInByb3RvdHlwZSIsIlN0cmluZyIsIk51bWJlciIsIk1hdGgiLCJSZWdFeHAiLCJDb3JlQ29uZmlnIiwiaXNFbXB0eSIsInZhbHVlIiwiaXNVbmRlZmluZWQiLCJoYXNWYWx1ZSIsImhhc1Byb3BlcnR5Iiwib2JqZWN0IiwicHJvcGVydGllcyIsInRhcmdldCIsImFyZyIsImhhc093blByb3BlcnR5IiwiZXh0ZW5kIiwiY29uZmlnIiwiJGluamVjdCIsIkZpbGVFeHRlbnNpb25zIiwiJHdpbmRvdyIsImlzRmlsZSIsIml0ZW0iLCJpc09iamVjdCIsIkZpbGUiLCJpc0ltYWdlIiwiZmlsZSIsInR5cGUiLCJzbGljZSIsImxhc3RJbmRleE9mIiwiZmlsZVN1cHBvcnQiLCJGaWxlUmVhZGVyIiwiQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIiwicnVuIiwidG9CeXRlcyIsImhvbGRlciIsInNpemUiLCJsb2ciLCJudW0iLCJwb3ciLCJ0b0ZpeGVkIiwidGV4dCIsInN1cHBsYW50IiwibyIsInJlcGxhY2UiLCJiIiwiciIsInJlcGxhY2VBbGwiLCJzZWFyY2hWYWx1ZSIsInJlcGxhY2VWYWx1ZSIsImNyaXBFbnRlciIsImxpbmsiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsImN0cmwiLCJiaW5kIiwiZXZlbnQiLCJ3aGljaCIsIiRhcHBseSIsIiRldmFsIiwicHJldmVudERlZmF1bHQiLCIkb24iLCJvZmYiLCJyZXN0cmljdCIsImRpcmVjdGl2ZSIsImNyaXBGb2N1cyIsImZvY3VzIiwib24iLCJjcmlwU2VsZWN0b3IiLCJjcmlwVGh1bWIiLCJvbkxvYWRGaWxlIiwiaW1nIiwiSW1hZ2UiLCJvbmxvYWQiLCJvbkxvYWRJbWFnZSIsInNyYyIsInJlc3VsdCIsIndpZHRoIiwicGFyYW1zIiwiaGVpZ2h0IiwiY2FudmFzIiwiYXR0ciIsImdldENvbnRleHQiLCJkcmF3SW1hZ2UiLCJoaWRlIiwiZmluZCIsInJlYWRlciIsInJlYWRBc0RhdGFVUkwiLCJ0ZW1wbGF0ZSIsIiQiLCIkdGltZW91dCIsInNlbGVjdG9yIiwiY2FsbGJhY2siLCIkZWxlbWVudCIsImZhY3RvcnkiLCJqUXVlcnkiLCJjcmlwU3RyUmFuZG9tIiwicG9zc2libGUiLCJjaGFuZ2VDaGFycyIsImNoYXJzIiwiY2hhckF0IiwiZmxvb3IiLCJyYW5kb20iLCJzZXJ2aWNlIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxHQUNBLFlBRUFBLEdBQUFDLEtBQUFGLEVBQUFHLE9BQUEsaUJBRUFDLFFBQUFDLE9BQUFKLE9BQUFJLE9BQUFKLFVDTEEsU0FBQUssR0FDQSxZQVlBLFNBQUFDLEdBQUFDLEdBQ0EsTUFBQUMsTUFBQUMsT0FBQSxTQUFBQyxHQUNBLE1BQUFILEdBQUFJLFFBQUFELEdBQUEsSUFVQSxRQUFB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LFNBQUEsYUFtQkE4RSxPQUFBcEgsT0FBQUosT0FBQUksT0FBQUosVUN6QkEsU0FBQUEsRUFBQTJCLEdBQ0EsWUFPQSxTQUFBOEYsS0FDQSxHQUFBQyxHQUFBLG9FQUVBbEgsTUFBQW1ILFlBQUEsU0FBQUMsR0FDQUYsRUFBQUUsR0FHQXBILEtBQUFBLE9BQUEsU0FBQVEsR0FDQUEsR0FBQSxFQUVBLEtBQUEsR0FEQXFGLEdBQUEsR0FDQTNGLEVBQUEsRUFBQU0sRUFBQU4sRUFBQUEsSUFDQTJGLEdBQUFxQixFQUFBRyxPQUFBbEcsRUFBQW1HLE1BQUFuRyxFQUFBb0csU0FBQUwsRUFBQTFHLFFBR0EsT0FBQXFGLElBbkJBckcsRUFBQUMsS0FDQStILFFBQUEsZ0JBQUFQLEdBRUFBLEVBQUEvRSxZQW1CQXRDLE9BQUFKLE9BQUFJLE9BQUFKLFNBQUEyQiIsImZpbGUiOiJjcmlwLWNvcmUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIChuZywgY3JpcCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuY29yZSA9IG5nLm1vZHVsZSgnY3JpcC5jb3JlJywgW10pO1xyXG5cclxufSkoYW5ndWxhciwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pKTsiLCIoZnVuY3Rpb24gKEFycmF5KSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgQXJyYXkucHJvdG90eXBlLmRpZmYgPSBkaWZmO1xyXG4gICAgQXJyYXkucHJvdG90eXBlLnJlbW92ZUl0ZW0gPSByZW1vdmVJdGVtO1xyXG4gICAgQXJyYXkucHJvdG90eXBlLmNsZWFuID0gY2xlYW47XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgZGlmZmVyZW50IGVsZW1lbnRzIGZyb20gQXJyYXlcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhXHJcbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9XHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIGRpZmYoYSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbiAoaSkge1xyXG4gICAgICAgICAgICByZXR1cm4gYS5pbmRleE9mKGkpIDwgMDtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZSBpdGVtIGZyb20gQXJyYXlcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0geyp9IHZhbFxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGtleVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiByZW1vdmVJdGVtKHZhbCwga2V5KSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBrZXkgPT09IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgdGhpcy5zcGxpY2UoKHRoaXMuaW5kZXhPZih2YWwpIHx8IHRoaXMubGVuZ3RoKSwgMSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzW2ldW2tleV0gPT0gdmFsKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2xlYW4gYXJyYXkgZnJvbSBlbXB0eSB2YWx1ZXNcclxuICAgICAqIElmIHBhcmFtZXRlcnMgcHJlc2VudGVkLCBkZWxldGUgaXRlbXMgd2l0Y2ggY29udGFpbnMgcGFzc2VkIHZhbHVlXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHsuLi5UfSBbZGVsZXRlX3ZhbHVlXVxyXG4gICAgICogQHJldHVybnMge0FycmF5fVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBjbGVhbihkZWxldGVfdmFsdWUpIHtcclxuICAgICAgICB2YXIgY2xlYW5fZnJvbSA9IGFyZ3VtZW50cztcclxuICAgICAgICBpZiAodHlwZW9mIGRlbGV0ZV92YWx1ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgY2xlYW5fZnJvbSA9IFt1bmRlZmluZWQsICcnLCBudWxsLCBOQU5dO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IHRoaXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGNsZWFuX2Zyb20ubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzW2ldID09PSBjbGVhbl9mcm9tW2pdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaS0tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbn0pKEFycmF5KTsiLCIoZnVuY3Rpb24gKG5nLCBjcmlwLCBBcnJheSwgU3RyaW5nLCBOdW1iZXIsIE1hdGgsIFJlZ0V4cCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuY29yZVxyXG4gICAgICAgIC5jb25maWcoQ29yZUNvbmZpZyk7XHJcblxyXG4gICAgQ29yZUNvbmZpZy4kaW5qZWN0ID0gW107XHJcblxyXG4gICAgZnVuY3Rpb24gQ29yZUNvbmZpZygpIHtcclxuXHJcbiAgICAgICAgbmcuZXh0ZW5kKG5nLCB7XHJcbiAgICAgICAgICAgIGlzRW1wdHk6IGlzRW1wdHksXHJcbiAgICAgICAgICAgIGhhc1ZhbHVlOiBoYXNWYWx1ZSxcclxuICAgICAgICAgICAgaGFzUHJvcGVydHk6IGhhc1Byb3BlcnR5XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIERldGVybWluZXMgaXMgdmFsdWUgZW1wdHlcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSB2YWx1ZVxyXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGZ1bmN0aW9uIGlzRW1wdHkodmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5nLmlzVW5kZWZpbmVkKHZhbHVlKSB8fCB2YWx1ZSA9PT0gJycgfHwgdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgIT09IHZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRGV0ZXJtaW5lcyBpcyB2YWx1ZSBpbiBvYmplY3RcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSB2YWx1ZVxyXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGZ1bmN0aW9uIGhhc1ZhbHVlKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAhaXNFbXB0eSh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBEZXRlcm1pbmVzIGlzIG9iamVjdCBjb250YWluaW5nIHByb3BlcnRpZXMgY2hhaW5cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvYmplY3RcclxuICAgICAgICAgKiBAcGFyYW0gey4uLnN0cmluZ30gcHJvcGVydGllc1xyXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGZ1bmN0aW9uIGhhc1Byb3BlcnR5KG9iamVjdCwgcHJvcGVydGllcykge1xyXG4gICAgICAgICAgICB2YXIgYSA9IGFyZ3VtZW50cztcclxuXHJcbiAgICAgICAgICAgIGlmIChhLmxlbmd0aCA9PT0gMCB8fCBpc0VtcHR5KGFbMF0pKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGFbMF07XHJcbiAgICAgICAgICAgIGZvciAodmFyIGFyZyBpbiBhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXJnID09PSAnMCcpXHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0YXJnZXQuaGFzT3duUHJvcGVydHkoYVthcmddKSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0W2FbYXJnXV07XHJcbiAgICAgICAgICAgICAgICBpZiAobmcuaXNVbmRlZmluZWQodGFyZ2V0KSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoYW5ndWxhciwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pLCBBcnJheSwgU3RyaW5nLCBOdW1iZXIsIE1hdGgsIFJlZ0V4cCk7IiwiKGZ1bmN0aW9uKG5nLCBjcmlwKXtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmNvcmVcclxuICAgICAgICAucnVuKEZpbGVFeHRlbnNpb25zKTtcclxuXHJcbiAgICBGaWxlRXh0ZW5zaW9ucy4kaW5qZWN0ID0gWyckd2luZG93J107XHJcblxyXG4gICAgZnVuY3Rpb24gRmlsZUV4dGVuc2lvbnMoJHdpbmRvdykge1xyXG5cclxuICAgICAgICBuZy5leHRlbmQobmcsIHtcclxuICAgICAgICAgICAgaXNGaWxlOiBpc0ZpbGUsXHJcbiAgICAgICAgICAgIGlzSW1hZ2U6IGlzSW1hZ2UsXHJcbiAgICAgICAgICAgIGZpbGVTdXBwb3J0OiAhISgkd2luZG93LkZpbGVSZWFkZXIgJiYgJHdpbmRvdy5DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIERldGVybWluZXMgaXMgaXRlbSBhbiBpbnN0YW5jZSBvZiBGaWxlXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0geyp9IGl0ZW1cclxuICAgICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuICAgICAgICAgKi9cclxuICAgICAgICBmdW5jdGlvbiBpc0ZpbGUoaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmcuaXNPYmplY3QoaXRlbSkgJiYgaXRlbSBpbnN0YW5jZW9mICR3aW5kb3cuRmlsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIERldGVybWluZXMgaXMgZmlsZSBhbiB0eXBlIG9mIGltYWdlXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0ge0ZpbGV9IGZpbGVcclxuICAgICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuICAgICAgICAgKi9cclxuICAgICAgICBmdW5jdGlvbiBpc0ltYWdlKGZpbGUpIHtcclxuICAgICAgICAgICAgdmFyIHR5cGUgPSAnfCcgKyBmaWxlLnR5cGUuc2xpY2UoZmlsZS50eXBlLmxhc3RJbmRleE9mKCcvJykgKyAxKSArICd8JztcclxuICAgICAgICAgICAgcmV0dXJuICd8anBnfHBuZ3xqcGVnfGJtcHxnaWZ8Jy5pbmRleE9mKHR5cGUpICE9PSAtMTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKGFuZ3VsYXIsIHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSk7IiwiKGZ1bmN0aW9uKE51bWJlcil7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgTnVtYmVyLnByb3RvdHlwZS50b0J5dGVzID0gdG9CeXRlcztcclxuXHJcbiAgICAvKipcclxuICAgICAqIENvbnZlcnQgTnVtYmVyIHRvIHVzZXIgZnJpZW5kbHkgYnl0ZSBzdHJpbmdcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW2hvbGRlcl1cclxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIHRvQnl0ZXMoaG9sZGVyKSB7XHJcbiAgICAgICAgaG9sZGVyID0gaG9sZGVyIHx8IChob2xkZXIgPSB7fSk7XHJcbiAgICAgICAgaG9sZGVyLnZhbHVlID0gdGhpcztcclxuICAgICAgICBob2xkZXIuc2l6ZSA9IE1hdGgubG9nKGhvbGRlci52YWx1ZSkgLyBNYXRoLmxvZygxZTMpIHwgMDtcclxuICAgICAgICBob2xkZXIubnVtID0gKGhvbGRlci52YWx1ZSAvIE1hdGgucG93KDFlMywgaG9sZGVyLnNpemUpKS50b0ZpeGVkKDIpO1xyXG4gICAgICAgIGhvbGRlci50ZXh0ID0gKGhvbGRlci5zaXplID8gKCdrTUdUUEVaWSdbLS1ob2xkZXIuc2l6ZV0gKyAnQicpIDogJ0J5dGVzJyk7XHJcblxyXG4gICAgICAgIHJldHVybiAne251bX0ge3RleHR9Jy5zdXBwbGFudChob2xkZXIpO1xyXG4gICAgfVxyXG59KShOdW1iZXIpOyIsIihmdW5jdGlvbiAoU3RyaW5nKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgU3RyaW5nLnByb3RvdHlwZS5zdXBwbGFudCA9IHN1cHBsYW50O1xyXG4gICAgU3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlQWxsID0gcmVwbGFjZUFsbDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEEgc2ltcGxlIHRlbXBsYXRpbmcgbWV0aG9kIGZvciByZXBsYWNpbmcgcGxhY2Vob2xkZXJzIGVuY2xvc2VkIGluIGN1cmx5IGJyYWNlcy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gb1xyXG4gICAgICogQHJldHVybnMge3N0cmluZ31cclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gc3VwcGxhbnQobykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlcGxhY2UoL3soW157fV0qKX0vZyxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIHZhciByID0gb1tiXTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgciA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIHIgPT09ICdudW1iZXInID8gciA6IGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmVwbGFjZSBhbGwgb2NjdXJyZW5jZXMgaW4gc3RyaW5nXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHNlYXJjaFZhbHVlIFVzZWQgaW4gUmVnRXhwXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ3xmdW5jdGlvbn0gcmVwbGFjZVZhbHVlXHJcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiByZXBsYWNlQWxsKHNlYXJjaFZhbHVlLCByZXBsYWNlVmFsdWUpIHtcclxuICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcztcclxuICAgICAgICByZXR1cm4gdGFyZ2V0LnJlcGxhY2UobmV3IFJlZ0V4cChzZWFyY2hWYWx1ZSwgJ2cnKSwgcmVwbGFjZVZhbHVlKTtcclxuICAgIH1cclxuXHJcbn0pKFN0cmluZyk7IiwiKGZ1bmN0aW9uIChuZywgY3JpcCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuY29yZVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ2NyaXBFbnRlcicsIGNyaXBFbnRlcik7XHJcblxyXG4gICAgY3JpcEVudGVyLiRpbmplY3QgPSBbXTtcclxuXHJcbiAgICBmdW5jdGlvbiBjcmlwRW50ZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgbGluazogbGlua1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuYmluZChcImtleWRvd24ga2V5cHJlc3NcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWwoYXR0cnMuY3JpcEVudGVyLCB7J2V2ZW50JzogZXZlbnR9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBSZW1vdmVzIGJvdW5kIGV2ZW50cyBpbiB0aGUgZWxlbWVudCBpdHNlbGZcclxuICAgICAgICAgICAgLy8gd2hlbiB0aGUgc2NvcGUgaXMgZGVzdHJveWVkXHJcbiAgICAgICAgICAgIHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9mZihhdHRycy5jcmlwRW50ZXIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKGFuZ3VsYXIsIHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSk7XHJcbiIsIihmdW5jdGlvbiAoY3JpcCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuY29yZVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ2NyaXBGb2N1cycsIGNyaXBGb2N1cyk7XHJcblxyXG4gICAgY3JpcEZvY3VzLiRpbmplY3QgPSBbJ2ZvY3VzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gY3JpcEZvY3VzKGZvY3VzKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgbGluazogbGlua1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQub24oYXR0cnMuY3JpcEZvY3VzLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBmb2N1cyhhdHRycy5jcmlwU2VsZWN0b3IpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJlbW92ZXMgYm91bmQgZXZlbnRzIGluIHRoZSBlbGVtZW50IGl0c2VsZlxyXG4gICAgICAgICAgICAvLyB3aGVuIHRoZSBzY29wZSBpcyBkZXN0cm95ZWRcclxuICAgICAgICAgICAgc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQub2ZmKGF0dHJzLmNyaXBGb2N1cyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkod2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pKTsiLCIoZnVuY3Rpb24gKG5nLCBjcmlwKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5jb3JlXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnY3JpcFRodW1iJywgY3JpcFRodW1iKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjcmlwVGh1bWIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8Y2FudmFzLz4nLFxyXG4gICAgICAgICAgICBsaW5rOiBsaW5rXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpe1xyXG4gICAgICAgICAgICBpZighbmcuZmlsZVN1cHBvcnQpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBzY29wZS4kZXZhbChhdHRycy5jcmlwVGh1bWIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFuZy5pc0ZpbGUocGFyYW1zLmZpbGUpIHx8ICFuZy5pc0ltYWdlKHBhcmFtcy5maWxlKSkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBjYW52YXMgPSBlbGVtZW50LmZpbmQoJ2NhbnZhcycpO1xyXG4gICAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuXHJcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBvbkxvYWRGaWxlO1xyXG4gICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChwYXJhbXMuZmlsZSk7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBvbkxvYWRGaWxlKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XHJcbiAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gb25Mb2FkSW1hZ2U7XHJcbiAgICAgICAgICAgICAgICBpbWcuc3JjID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gb25Mb2FkSW1hZ2UoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSBwYXJhbXMud2lkdGggfHwgdGhpcy53aWR0aCAvIHRoaXMuaGVpZ2h0ICogcGFyYW1zLmhlaWdodDtcclxuICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBwYXJhbXMuaGVpZ2h0IHx8IHRoaXMuaGVpZ2h0IC8gdGhpcy53aWR0aCAqIHBhcmFtcy53aWR0aDtcclxuICAgICAgICAgICAgICAgIGNhbnZhcy5hdHRyKHt3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0fSk7XHJcbiAgICAgICAgICAgICAgICBjYW52YXNbMF0uZ2V0Q29udGV4dCgnMmQnKS5kcmF3SW1hZ2UodGhpcywgMCwgMCwgd2lkdGgsIGhlaWdodCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KShhbmd1bGFyLCB3aW5kb3cuY3JpcCB8fCAod2luZG93LmNyaXAgPSB7fSkpOyIsIihmdW5jdGlvbiAoJCwgY3JpcCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuY29yZVxyXG4gICAgICAgIC5mYWN0b3J5KCdmb2N1cycsIGZvY3VzKTtcclxuXHJcbiAgICBmb2N1cy4kaW5qZWN0ID0gWyckdGltZW91dCddO1xyXG5cclxuICAgIGZ1bmN0aW9uIGZvY3VzKCR0aW1lb3V0KSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzZWxlY3RvciwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgLy8gdGltZW91dCBtYWtlcyBzdXJlIHRoYXQgaXQgaXMgaW52b2tlZCBhZnRlciBhbnkgb3RoZXIgZXZlbnQgaGFzIGJlZW4gdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAvLyBlLmcuIGNsaWNrIGV2ZW50cyB0aGF0IG5lZWQgdG8gcnVuIGJlZm9yZSB0aGUgZm9jdXMgb3JcclxuICAgICAgICAgICAgLy8gaW5wdXRzIGVsZW1lbnRzIHRoYXQgYXJlIGluIGEgZGlzYWJsZWQgc3RhdGUgYnV0IGFyZSBlbmFibGVkIHdoZW4gdGhvc2UgZXZlbnRzXHJcbiAgICAgICAgICAgIC8vIGFyZSB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciAkZWxlbWVudCA9ICQoc2VsZWN0b3IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRlbGVtZW50Lmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRlbGVtZW50LmZvY3VzKGNhbGxiYWNrKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRlbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoalF1ZXJ5LCB3aW5kb3cuY3JpcCB8fCAod2luZG93LmNyaXAgPSB7fSkpOyIsIihmdW5jdGlvbiAoY3JpcCwgTWF0aCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuY29yZVxyXG4gICAgICAgIC5zZXJ2aWNlKCdjcmlwU3RyUmFuZG9tJywgY3JpcFN0clJhbmRvbSk7XHJcblxyXG4gICAgY3JpcFN0clJhbmRvbS4kaW5qZWN0ID0gW107XHJcblxyXG4gICAgZnVuY3Rpb24gY3JpcFN0clJhbmRvbSgpIHtcclxuICAgICAgICB2YXIgcG9zc2libGUgPSAnLV9BQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OV8tJztcclxuXHJcbiAgICAgICAgdGhpcy5jaGFuZ2VDaGFycyA9IGZ1bmN0aW9uIChjaGFycykge1xyXG4gICAgICAgICAgICBwb3NzaWJsZSA9IGNoYXJzO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMubmV3ID0gZnVuY3Rpb24gKGxlbmd0aCkge1xyXG4gICAgICAgICAgICBsZW5ndGggfD0gMTY7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSAnJztcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBvc3NpYmxlLmNoYXJBdChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBwb3NzaWJsZS5sZW5ndGgpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSh3aW5kb3cuY3JpcCB8fCAod2luZG93LmNyaXAgPSB7fSksIE1hdGgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
